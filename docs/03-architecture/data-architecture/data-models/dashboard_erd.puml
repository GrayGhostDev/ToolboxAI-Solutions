@startuml
!define ENTITY entity
!define TABLE(x) class x << (T,#FFAAAA) >>
!define PRIMARY_KEY(x) <u>x</u>
!define FOREIGN_KEY(x) <i>x</i>

title Dashboard Database ERD

TABLE(schools) {
  name: VARCHAR(200)
  address: VARCHAR(500)
  city: VARCHAR(100)
  state: VARCHAR(50)
  zip_code: VARCHAR(10)
  phone: VARCHAR(20)
  email: VARCHAR(100)
  principal_name: VARCHAR(100)
  district: VARCHAR(200)
  max_students: INTEGER
  student_count: INTEGER
  teacher_count: INTEGER
  class_count: INTEGER
  is_active: BOOLEAN
  logo_url: VARCHAR(500)
  website: VARCHAR(500)
  founded_year: INTEGER
  created_at: TIMESTAMPTZ
  updated_at: TIMESTAMPTZ
}

TABLE(dashboard_users) {
  password_hash: VARCHAR(255)
  first_name: VARCHAR(100)
  last_name: VARCHAR(100)
  role: VARCHAR(20)
  FOREIGN_KEY(school_id): VARCHAR(36)
  grade_level: INTEGER
  phone: VARCHAR(20)
  address: TEXT
  emergency_contact_name: VARCHAR(100)
  emergency_contact_phone: VARCHAR(20)
  is_active: BOOLEAN
  is_verified: BOOLEAN
  profile_picture_url: VARCHAR(500)
  last_login: TIMESTAMPTZ
  created_at: TIMESTAMPTZ
  updated_at: TIMESTAMPTZ
}

TABLE(classes) {
  name: VARCHAR(200)
  description: TEXT
  subject: VARCHAR(100)
  grade_level: INTEGER
  FOREIGN_KEY(teacher_id): VARCHAR(36)
  FOREIGN_KEY(school_id): VARCHAR(36)
  schedule: VARCHAR(200)
  start_date: DATE
  end_date: DATE
  max_students: INTEGER
  student_count: INTEGER
  room: VARCHAR(50)
  is_active: BOOLEAN
  syllabus_url: VARCHAR(500)
  created_at: TIMESTAMPTZ
  updated_at: TIMESTAMPTZ
}

TABLE(class_students) {
  FOREIGN_KEY(class_id): VARCHAR(36)
  FOREIGN_KEY(student_id): VARCHAR(36)
  enrolled_at: TIMESTAMPTZ
  status: VARCHAR(20)
  grade: DECIMAL
  attendance_rate: DECIMAL
}

TABLE(assignments) {
  title: VARCHAR(200)
  description: TEXT
  type: VARCHAR(50)
  subject: VARCHAR(100)
  FOREIGN_KEY(class_id): VARCHAR(36)
  FOREIGN_KEY(teacher_id): VARCHAR(36)
  due_date: TIMESTAMPTZ
  points: INTEGER
  status: VARCHAR(20)
  instructions: TEXT
  materials_url: VARCHAR(500)
  is_published: BOOLEAN
  created_at: TIMESTAMPTZ
  updated_at: TIMESTAMPTZ
}

TABLE(submissions) {
  FOREIGN_KEY(assignment_id): VARCHAR(36)
  FOREIGN_KEY(student_id): VARCHAR(36)
  submitted_at: TIMESTAMPTZ
  status: VARCHAR(20)
  grade: DECIMAL
  progress: INTEGER
  content: TEXT
  file_url: VARCHAR(500)
  feedback: TEXT
  graded_at: TIMESTAMPTZ
  FOREIGN_KEY(graded_by): VARCHAR(36)
}

TABLE(lessons) {
  title: VARCHAR(200)
  description: TEXT
  subject: VARCHAR(100)
  FOREIGN_KEY(class_id): VARCHAR(36)
  FOREIGN_KEY(teacher_id): VARCHAR(36)
  scheduled_at: TIMESTAMPTZ
  duration_minutes: INTEGER
  lesson_type: VARCHAR(50)
  content_url: VARCHAR(500)
  roblox_world_id: VARCHAR(100)
  learning_objectives: TEXT
  materials: TEXT
  status: VARCHAR(20)
  created_at: TIMESTAMPTZ
  updated_at: TIMESTAMPTZ
}

TABLE(student_progress) {
  FOREIGN_KEY(student_id): VARCHAR(36)
  FOREIGN_KEY(class_id): VARCHAR(36)
  subject: VARCHAR(100)
  grade_level: INTEGER
  xp_points: INTEGER
  level: INTEGER
  streak_days: INTEGER
  total_badges: INTEGER
  rank_position: INTEGER
  gpa: DECIMAL
  attendance_rate: DECIMAL
  assignments_completed: INTEGER
  assignments_total: INTEGER
  last_activity: TIMESTAMPTZ
  created_at: TIMESTAMPTZ
  updated_at: TIMESTAMPTZ
}

TABLE(student_activity) {
  FOREIGN_KEY(student_id): VARCHAR(36)
  type: VARCHAR(50)
  description: TEXT
  xp_earned: INTEGER
  FOREIGN_KEY(class_id): VARCHAR(36)
  created_at: TIMESTAMPTZ
}

TABLE(student_achievements) {
  FOREIGN_KEY(student_id): VARCHAR(36)
  FOREIGN_KEY(achievement_id): INTEGER
  earned_at: TIMESTAMPTZ
  FOREIGN_KEY(class_id): VARCHAR(36)
}

TABLE(attendance) {
  FOREIGN_KEY(student_id): VARCHAR(36)
  FOREIGN_KEY(class_id): VARCHAR(36)
  FOREIGN_KEY(lesson_id): VARCHAR(36)
  date: DATE
  status: VARCHAR(20)
  notes: TEXT
  FOREIGN_KEY(recorded_by): VARCHAR(36)
  recorded_at: TIMESTAMPTZ
}

TABLE(messages) {
  FOREIGN_KEY(sender_id): VARCHAR(36)
  FOREIGN_KEY(recipient_id): VARCHAR(36)
  subject: VARCHAR(200)
  content: TEXT
  type: VARCHAR(20)
  priority: VARCHAR(20)
  is_read: BOOLEAN
  read_at: TIMESTAMPTZ
  FOREIGN_KEY(class_id): VARCHAR(36)
  created_at: TIMESTAMPTZ
}

TABLE(parent_children) {
  FOREIGN_KEY(parent_id): VARCHAR(36)
  FOREIGN_KEY(student_id): VARCHAR(36)
  relationship: VARCHAR(50)
  is_primary: BOOLEAN
  can_view_grades: BOOLEAN
  can_view_attendance: BOOLEAN
  created_at: TIMESTAMPTZ
}

TABLE(system_events) {
  event_type: VARCHAR(50)
  message: TEXT
  severity: VARCHAR(20)
  FOREIGN_KEY(user_id): VARCHAR(36)
  metadata: JSONB
  created_at: TIMESTAMPTZ
}

TABLE(api_logs) {
  method: VARCHAR(10)
  endpoint: VARCHAR(500)
  status_code: INTEGER
  response_time: DECIMAL
  FOREIGN_KEY(user_id): VARCHAR(36)
  ip_address: INET
  user_agent: TEXT
  timestamp: TIMESTAMPTZ
}

TABLE(compliance_records) {
  type: VARCHAR(50)
  status: VARCHAR(20)
  details: JSONB
  FOREIGN_KEY(reviewed_by): VARCHAR(36)
  reviewed_at: TIMESTAMPTZ
  created_at: TIMESTAMPTZ
}


@enduml