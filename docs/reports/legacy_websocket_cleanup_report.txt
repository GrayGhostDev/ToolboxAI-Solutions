============================================================
Legacy WebSocket Code Cleanup Report
============================================================
Generated: 2025-09-23T14:24:16.854303

Statistics:
----------------------------------------
Files scanned: 216
Files with legacy code: 62
Total legacy patterns found: 415

Files with Legacy Code:
----------------------------------------

ğŸ“„ tests/accessibility/a11y_test_runner.py
  âš ï¸  Socket.IO client: 2 occurrence(s)
     Line 427: function getContrastRatio(l1, l2) {
     Line 452: const ratio = getContrastRatio(bgLuminance, textLuminance);

ğŸ“„ tests/conftest.py
  âš ï¸  WebSocket constructor: 1 occurrence(s)
     Line 457: return MockWebSocket()
  âš ï¸  websocket_handler module: 2 occurrence(s)
     Line 1033: patch('apps.backend.services.websocket_handler.decode_access_token', side_effect=mock_decode),
     Line 1034: patch('apps.backend.services.websocket_handler.increment_metric', side_effect=increment_metric),
  âš ï¸  MockWebSocket class: 2 occurrence(s)
     Line 425: class MockWebSocket:
     Line 457: return MockWebSocket()

ğŸ“„ tests/disaster_recovery/dr_test_runner.py
  âš ï¸  Socket.IO client: 3 occurrence(s)
     Line 122: async def run_scenario(self, scenario_name: str) -> Dict[str, Any]:
     Line 864: result = await self.run_scenario(scenario["name"])
     Line 945: asyncio.run(tester.run_scenario(args.scenario))

ğŸ“„ tests/e2e/test_comprehensive_end_to_end.py
  âš ï¸  WebSocket constructor: 1 occurrence(s)
     Line 456: const ws = new originalWebSocket(url, protocols);

ğŸ“„ tests/e2e/test_e2e_integration.py
  âš ï¸  Socket.IO client: 6 occurrence(s)
     Line 101: @pytest.mark.asyncio(loop_scope="function")
     Line 159: @pytest.mark.asyncio(loop_scope="function")
     Line 252: @pytest.mark.asyncio(loop_scope="function")
     ... and 3 more

ğŸ“„ tests/fixtures/api.py
  âš ï¸  Old mock_websocket (not migrated): 1 occurrence(s)
     Line 202: def mock_websocket():

ğŸ“„ tests/fixtures/websocket.py
  âš ï¸  WebSocket constructor: 1 occurrence(s)
     Line 5: def create_websocket(): return MockWebSocket()
  âš ï¸  MockWebSocket class: 2 occurrence(s)
     Line 1: class MockWebSocket:
     Line 5: def create_websocket(): return MockWebSocket()

ğŸ“„ tests/integration/conftest.py
  âš ï¸  MockWebSocket class: 6 occurrence(s)
     Line 121: class MockWebSocketConnection:
     Line 178: class MockWebSocketManager:
     Line 281: return MockWebSocketConnection()
     ... and 3 more

ğŸ“„ tests/integration/test_advanced_supervisor.py
  âš ï¸  Socket.IO client: 22 occurrence(s)
     Line 103: @pytest.mark.asyncio(loop_scope="function")
     Line 116: @pytest.mark.asyncio(loop_scope="function")
     Line 159: @pytest.mark.asyncio(loop_scope="function")
     ... and 19 more

ğŸ“„ tests/integration/test_agent_communication_integration.py
  âš ï¸  Socket.IO client: 9 occurrence(s)
     Line 139: @pytest.mark.asyncio(loop_scope="function")
     Line 169: @pytest.mark.asyncio(loop_scope="function")
     Line 209: @pytest.mark.asyncio(loop_scope="function")
     ... and 6 more

ğŸ“„ tests/integration/test_agent_integration.py
  âš ï¸  Socket.IO client: 15 occurrence(s)
     Line 129: @pytest.mark.asyncio(loop_scope="function")
     Line 202: @pytest.mark.asyncio(loop_scope="function")
     Line 226: @pytest.mark.asyncio(loop_scope="function")
     ... and 12 more

ğŸ“„ tests/integration/test_api_v1_endpoints_integration.py
  âš ï¸  Socket.IO client: 1 occurrence(s)
     Line 337: @pytest.mark.asyncio(loop_scope="function")

ğŸ“„ tests/integration/test_auth_system.py
  âš ï¸  Socket.IO client: 2 occurrence(s)
     Line 35: @pytest.mark.asyncio(loop_scope="function")
     Line 148: @pytest.mark.asyncio(loop_scope="function")

ğŸ“„ tests/integration/test_complete_integration.py
  âš ï¸  Direct websockets import: 1 occurrence(s)
     Line 42: import websocket
  âš ï¸  socketio module: 5 occurrence(s)
     Line 41: import socketio
     Line 84: self.socketio_client = None
     Line 328: def test_socketio_connection(self) -> bool:
     ... and 2 more

ğŸ“„ tests/integration/test_comprehensive_verification.py
  âš ï¸  Socket.IO client: 8 occurrence(s)
     Line 111: @pytest.mark.asyncio(loop_scope="function")
     Line 171: @pytest.mark.asyncio(loop_scope="function")
     Line 207: @pytest.mark.asyncio(loop_scope="function")
     ... and 5 more

ğŸ“„ tests/integration/test_core_agent_communication.py
  âš ï¸  Socket.IO client: 5 occurrence(s)
     Line 116: @pytest.mark.asyncio(loop_scope="function")
     Line 144: @pytest.mark.asyncio(loop_scope="function")
     Line 185: @pytest.mark.asyncio(loop_scope="function")
     ... and 2 more

ğŸ“„ tests/integration/test_dashboard_integration.py
  âš ï¸  Direct websockets import: 1 occurrence(s)
     Line 38: import websocket
  âš ï¸  Socket.IO client: 2 occurrence(s)
     Line 314: def test_multi_user_scenario(self):
     Line 407: self.test_multi_user_scenario()

ğŸ“„ tests/integration/test_databases.py
  âš ï¸  Socket.IO client: 1 occurrence(s)
     Line 28: @pytest.mark.asyncio(loop_scope="function")

ğŸ“„ tests/integration/test_enhanced_content_agent.py
  âš ï¸  Socket.IO client: 2 occurrence(s)
     Line 40: @pytest.mark.asyncio(loop_scope="function")
     Line 250: @pytest.mark.asyncio(loop_scope="function")

ğŸ“„ tests/integration/test_fastapi_comprehensive.py
  âš ï¸  Socket.IO client: 16 occurrence(s)
     Line 146: @pytest.mark.asyncio(loop_scope="function")
     Line 174: @pytest.mark.asyncio(loop_scope="function")
     Line 213: @pytest.mark.asyncio(loop_scope="function")
     ... and 13 more

ğŸ“„ tests/integration/test_fastapi_integration.py
  âš ï¸  Socket.IO client: 6 occurrence(s)
     Line 73: @pytest.mark.asyncio(loop_scope="function")
     Line 97: @pytest.mark.asyncio(loop_scope="function")
     Line 136: @pytest.mark.asyncio(loop_scope="function")
     ... and 3 more

ğŸ“„ tests/integration/test_full_integration.py
  âš ï¸  Socket.IO client: 12 occurrence(s)
     Line 93: @pytest.mark.asyncio(loop_scope="function")
     Line 131: @pytest.mark.asyncio(loop_scope="function")
     Line 175: @pytest.mark.asyncio(loop_scope="function")
     ... and 9 more
  âš ï¸  socketio module: 7 occurrence(s)
     Line 44: import socketio
     Line 433: async def test_socketio_connection(self):
     Line 439: sio_client = socketio.AsyncClient()
     ... and 4 more

ğŸ“„ tests/integration/test_mcp_integration.py
  âš ï¸  Socket.IO client: 7 occurrence(s)
     Line 61: @pytest.mark.asyncio(loop_scope="function")
     Line 115: @pytest.mark.asyncio(loop_scope="function")
     Line 188: @pytest.mark.asyncio(loop_scope="function")
     ... and 4 more

ğŸ“„ tests/integration/test_rate_limiting_fix.py
  âš ï¸  Socket.IO client: 3 occurrence(s)
     Line 131: @pytest.mark.asyncio(loop_scope="function")
     Line 148: @pytest.mark.asyncio(loop_scope="function")
     Line 182: @pytest.mark.asyncio(loop_scope="function")

ğŸ“„ tests/integration/test_roblox_integration.py
  âš ï¸  Socket.IO client: 18 occurrence(s)
     Line 70: def mock_roblox_studio():
     Line 102: return MockRobloxStudio()
     Line 192: @pytest.mark.asyncio(loop_scope="function")
     ... and 15 more

ğŸ“„ tests/integration/test_roblox_plugin.py
  âš ï¸  Direct websockets import: 1 occurrence(s)
     Line 24: import websocket

ğŸ“„ tests/integration/test_simple_rate_limit.py
  âš ï¸  Socket.IO client: 1 occurrence(s)
     Line 34: @pytest.mark.asyncio(loop_scope="function")

ğŸ“„ tests/integration/test_socketio_integration.py
  âš ï¸  Socket.IO reference: 3 occurrence(s)
     Line 73: socketio_path='socket.io',
     Line 98: socketio_path='socket.io',
     Line 130: socketio_path='socket.io',
  âš ï¸  Socket.IO client: 3 occurrence(s)
     Line 66: @pytest.mark.asyncio(loop_scope="function")
     Line 91: @pytest.mark.asyncio(loop_scope="function")
     Line 122: @pytest.mark.asyncio(loop_scope="function")
  âš ï¸  socketio module: 8 occurrence(s)
     Line 20: import socketio
     Line 32: sio = socketio.AsyncClient()
     Line 73: socketio_path='socket.io',
     ... and 5 more

ğŸ“„ tests/integration/test_socketio_status.py
  âš ï¸  Socket.IO reference: 1 occurrence(s)
     Line 24: assert data.get("path") == "/socket.io"
  âš ï¸  Socket.IO client: 1 occurrence(s)
     Line 14: @pytest.mark.asyncio(loop_scope="function")
  âš ï¸  socketio module: 2 occurrence(s)
     Line 16: async def test_socketio_status_endpoint_acks_and_path():
     Line 17: url = f"{FASTAPI_BASE}/socketio/status"

ğŸ“„ tests/integration/test_workflows.py
  âš ï¸  Socket.IO client: 17 occurrence(s)
     Line 60: @pytest.mark.asyncio(loop_scope="function")
     Line 81: @pytest.mark.asyncio(loop_scope="function")
     Line 99: @pytest.mark.asyncio(loop_scope="function")
     ... and 14 more

ğŸ“„ tests/performance/test_agent_performance.py
  âš ï¸  Socket.IO client: 6 occurrence(s)
     Line 33: @pytest.mark.asyncio(loop_scope="function")
     Line 89: @pytest.mark.asyncio(loop_scope="function")
     Line 158: @pytest.mark.asyncio(loop_scope="function")
     ... and 3 more

ğŸ“„ tests/performance/test_api_performance.py
  âš ï¸  Socket.IO client: 4 occurrence(s)
     Line 23: @pytest.mark.asyncio(loop_scope="function")
     Line 71: @pytest.mark.asyncio(loop_scope="function")
     Line 122: @pytest.mark.asyncio(loop_scope="function")
     ... and 1 more

ğŸ“„ tests/performance/test_database_performance.py
  âš ï¸  Socket.IO client: 6 occurrence(s)
     Line 46: @pytest.mark.asyncio(loop_scope="function")
     Line 87: @pytest.mark.asyncio(loop_scope="function")
     Line 147: @pytest.mark.asyncio(loop_scope="function")
     ... and 3 more

ğŸ“„ tests/performance/test_load.py
  âš ï¸  Socket.IO client: 10 occurrence(s)
     Line 116: @pytest.mark.asyncio(loop_scope="function")
     Line 172: @pytest.mark.asyncio(loop_scope="function")
     Line 216: @pytest.mark.asyncio(loop_scope="function")
     ... and 7 more

ğŸ“„ tests/performance/test_websocket_performance.py
  âš ï¸  Socket.IO client: 5 occurrence(s)
     Line 50: @pytest.mark.asyncio(loop_scope="function")
     Line 85: @pytest.mark.asyncio(loop_scope="function")
     Line 135: @pytest.mark.asyncio(loop_scope="function")
     ... and 2 more

ğŸ“„ tests/test_ai_chat.py
  âš ï¸  Direct websockets import: 1 occurrence(s)
     Line 19: import websocket

ğŸ“„ tests/test_database_pool_2025.py
  âš ï¸  Socket.IO client: 2 occurrence(s)
     Line 181: @pytest.mark.asyncio(loop_scope="function")
     Line 230: @pytest.mark.asyncio(loop_scope="function")

ğŸ“„ tests/test_error_handling.py
  âš ï¸  Socket.IO client: 13 occurrence(s)
     Line 76: @pytest.mark.asyncio(loop_scope="function")
     Line 88: @pytest.mark.asyncio(loop_scope="function")
     Line 89: @pytest.mark.asyncio(loop_scope="function")
     ... and 10 more

ğŸ“„ tests/test_logging_system.py
  âš ï¸  Socket.IO client: 8 occurrence(s)
     Line 212: @pytest.mark.asyncio(loop_scope="function")
     Line 220: @pytest.mark.asyncio(loop_scope="function")
     Line 237: @pytest.mark.asyncio(loop_scope="function")
     ... and 5 more

ğŸ“„ tests/test_password_security.py
  âš ï¸  Socket.IO client: 1 occurrence(s)
     Line 187: @pytest.mark.asyncio(loop_scope="function")

ğŸ“„ tests/test_query_optimization.py
  âš ï¸  Socket.IO client: 9 occurrence(s)
     Line 199: @pytest.mark.asyncio(loop_scope="function")
     Line 200: @pytest.mark.asyncio(loop_scope="function")
     Line 228: @pytest.mark.asyncio(loop_scope="function")
     ... and 6 more

ğŸ“„ tests/unit/core/test_agents.py
  âš ï¸  Socket.IO client: 33 occurrence(s)
     Line 103: @pytest.mark.asyncio(loop_scope="function")
     Line 154: @pytest.mark.asyncio(loop_scope="function")
     Line 174: @pytest.mark.asyncio(loop_scope="function")
     ... and 30 more

ğŸ“„ tests/unit/core/test_fixes.py
  âš ï¸  websocket_handler module: 1 occurrence(s)
     Line 41: with patch('apps.backend.services.websocket_handler.decode_access_token', return_value=mock_user):
  âš ï¸  socketio module: 3 occurrence(s)
     Line 81: def fix_socketio_tests():
     Line 88: with patch('apps.backend.services.socketio.sio', mock_sio):
     Line 110: with fix_socketio_tests():

ğŸ“„ tests/unit/core/test_mcp.py
  âš ï¸  WebSocket constructor: 5 occurrence(s)
     Line 110: websocket = MockWebSocket()
     Line 170: websocket = MockWebSocket()
     Line 199: websocket1 = MockWebSocket()
     ... and 2 more
  âš ï¸  MockWebSocket class: 6 occurrence(s)
     Line 73: class MockWebSocket:
     Line 110: websocket = MockWebSocket()
     Line 170: websocket = MockWebSocket()
     ... and 3 more
  âš ï¸  Socket.IO client: 5 occurrence(s)
     Line 97: @pytest.mark.asyncio(loop_scope="function")
     Line 106: @pytest.mark.asyncio(loop_scope="function")
     Line 166: @pytest.mark.asyncio(loop_scope="function")
     ... and 2 more

ğŸ“„ tests/unit/core/test_mcp_fixed.py
  âš ï¸  WebSocket constructor: 1 occurrence(s)
     Line 96: websocket = MockWebSocket()
  âš ï¸  MockWebSocket class: 2 occurrence(s)
     Line 59: class MockWebSocket:
     Line 96: websocket = MockWebSocket()
  âš ï¸  Socket.IO client: 2 occurrence(s)
     Line 83: @pytest.mark.asyncio(loop_scope="function")
     Line 92: @pytest.mark.asyncio(loop_scope="function")

ğŸ“„ tests/unit/core/test_models_unit_core.py
  âš ï¸  Socket.IO client: 1 occurrence(s)
     Line 413: @pytest.mark.asyncio(loop_scope="function")

ğŸ“„ tests/unit/core/test_plugin_pipeline.py
  âš ï¸  Socket.IO client: 19 occurrence(s)
     Line 67: @pytest.mark.asyncio(loop_scope="function")
     Line 79: @pytest.mark.asyncio(loop_scope="function")
     Line 111: @pytest.mark.asyncio(loop_scope="function")
     ... and 16 more

ğŸ“„ tests/unit/core/test_security.py
  âš ï¸  websocket_handler module: 1 occurrence(s)
     Line 231: with patch('apps.backend.services.websocket_handler.settings') as mock_settings:
  âš ï¸  WebSocketHandler class: 1 occurrence(s)
     Line 32: from tests.fixtures.pusher_test_utils import WebSocketManager, WebSocketHandler
  âš ï¸  Socket.IO client: 2 occurrence(s)
     Line 165: @pytest.mark.asyncio(loop_scope="function")
     Line 202: @pytest.mark.asyncio(loop_scope="function")

ğŸ“„ tests/unit/core/test_server_unit_core.py
  âš ï¸  websocket_handler module: 1 occurrence(s)
     Line 733: with patch('apps.backend.services.websocket_handler.broadcast_update') as mock_broadcast:
  âš ï¸  Socket.IO client: 14 occurrence(s)
     Line 101: @pytest.mark.asyncio(loop_scope="function")
     Line 279: @pytest.mark.asyncio(loop_scope="function")
     Line 335: @pytest.mark.asyncio(loop_scope="function")
     ... and 11 more

ğŸ“„ tests/unit/core/test_socketio_rbac_and_rate_limit.py
  âš ï¸  Socket.IO client: 2 occurrence(s)
     Line 42: @pytest.mark.asyncio(loop_scope="function")
     Line 82: @pytest.mark.asyncio(loop_scope="function")
  âš ï¸  socketio module: 3 occurrence(s)
     Line 33: from apps.backend.services.socketio import sio as sio_srv, connected_clients, content_request, ping
     Line 44: async def test_socketio_rbac_blocks_teacher_event_for_student(monkeypatch):
     Line 84: async def test_socketio_rate_limit_enforced_for_ping(monkeypatch):

ğŸ“„ tests/unit/core/test_socketio_status_endpoint.py
  âš ï¸  Socket.IO client: 1 occurrence(s)
     Line 40: @pytest.mark.asyncio(loop_scope="function")
  âš ï¸  socketio module: 6 occurrence(s)
     Line 27: # socketio_status function no longer exists in main.py
     Line 28: # from apps.backend.main import socketio_status
     Line 31: async def socketio_status():
     ... and 3 more

ğŸ“„ tests/unit/core/test_state_manager_unit_core.py
  âš ï¸  Socket.IO client: 3 occurrence(s)
     Line 18: @pytest.mark.asyncio(loop_scope="function")
     Line 39: @pytest.mark.asyncio(loop_scope="function")
     Line 56: @pytest.mark.asyncio(loop_scope="function")

ğŸ“„ tests/unit/core/test_websocket_channel_rbac_and_capacity.py
  âš ï¸  Socket.IO client: 2 occurrence(s)
     Line 46: @pytest.mark.asyncio(loop_scope="function")
     Line 72: @pytest.mark.asyncio(loop_scope="function")

ğŸ“„ tests/unit/core/test_websocket_config_overrides.py
  âš ï¸  Socket.IO client: 2 occurrence(s)
     Line 48: @pytest.mark.asyncio(loop_scope="function")
     Line 74: @pytest.mark.asyncio(loop_scope="function")

ğŸ“„ tests/unit/core/test_websocket_fixes.py
  âš ï¸  websocket_handler module: 4 occurrence(s)
     Line 60: with patch('apps.backend.services.websocket_handler.decode_access_token', side_effect=mock_decode_to
     Line 123: with patch('apps.backend.services.websocket_handler.increment_metric', side_effect=increment_metric)
     Line 124: with patch('apps.backend.services.websocket_handler.get_metric', side_effect=get_metric):
     ... and 1 more
  âš ï¸  MockWebSocket class: 2 occurrence(s)
     Line 145: class MockWebSocketManager:
     Line 164: mock_manager = MockWebSocketManager()
  âš ï¸  socketio module: 2 occurrence(s)
     Line 129: def fix_socketio_status():
     Line 137: with patch('apps.backend.socketio_server.connected_clients', mock_connected_clients):

ğŸ“„ tests/unit/core/test_websocket_message_auth.py
  âš ï¸  MockWebSocket class: 2 occurrence(s)
     Line 33: class MockWebSocketAuthSession:
     Line 75: session = MockWebSocketAuthSession(
  âš ï¸  Socket.IO client: 1 occurrence(s)
     Line 67: @pytest.mark.asyncio(loop_scope="function")

ğŸ“„ tests/unit/core/test_websocket_metrics_token_expired.py
  âš ï¸  MockWebSocket class: 5 occurrence(s)
     Line 54: class MockWebSocketAuthSession:
     Line 77: class MockWebSocketManager:
     Line 87: mock_pusher_as_websocket_manager = MockWebSocketManager()
     ... and 2 more
  âš ï¸  Socket.IO client: 2 occurrence(s)
     Line 102: @pytest.mark.asyncio(loop_scope="function")
     Line 130: @pytest.mark.asyncio(loop_scope="function")

ğŸ“„ tests/unit/core/test_websocket_rbac_and_rate_limit.py
  âš ï¸  MockWebSocket class: 3 occurrence(s)
     Line 56: class MockWebSocketManager:
     Line 125: manager = MockWebSocketManager()
     Line 151: manager = MockWebSocketManager()
  âš ï¸  Socket.IO client: 2 occurrence(s)
     Line 116: @pytest.mark.asyncio(loop_scope="function")
     Line 142: @pytest.mark.asyncio(loop_scope="function")

ğŸ“„ tests/unit/core/test_ws_rbac_reset_endpoint.py
  âš ï¸  Socket.IO client: 1 occurrence(s)
     Line 16: @pytest.mark.asyncio(loop_scope="function")

ğŸ“„ tests/unit/core/test_ws_rbac_runtime_update.py
  âš ï¸  Socket.IO client: 1 occurrence(s)
     Line 16: @pytest.mark.asyncio(loop_scope="function")

ğŸ“„ tests/unit/core/test_ws_status_endpoint.py
  âš ï¸  Socket.IO client: 1 occurrence(s)
     Line 15: @pytest.mark.asyncio(loop_scope="function")

ğŸ“„ tests/unit/security/test_cors_unit_security.py
  âš ï¸  Socket.IO client: 1 occurrence(s)
     Line 163: @pytest.mark.asyncio(loop_scope="function")

Recommendations:
----------------------------------------
1. Run the migration script on remaining files:
   python scripts/migrate_websocket_tests_to_pusher.py

2. For files that can't be auto-migrated, manually update using:
   docs/PUSHER_TESTING_GUIDE.md

3. After migration, run this script with --clean to remove legacy code:
   python scripts/cleanup_legacy_websocket_tests.py --clean

âš ï¸  This was a DRY RUN - no files were modified
Run with --clean to remove legacy code
Run with --comment to add migration TODOs