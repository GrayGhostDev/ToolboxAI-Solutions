apiVersion: v1
kind: ConfigMap
metadata:
  name: celery-config
  labels:
    app.kubernetes.io/name: celery
    app.kubernetes.io/instance: celery
    app.kubernetes.io/component: worker
    app.kubernetes.io/part-of: toolboxai-platform
    app.kubernetes.io/managed-by: kustomize
data:
  # Celery Worker Configuration
  CELERY_WORKER_CONCURRENCY: "4"
  CELERY_WORKER_POOL: "prefork"
  CELERY_WORKER_PREFETCH_MULTIPLIER: "4"
  CELERY_WORKER_MAX_TASKS_PER_CHILD: "1000"

  # Celery Task Configuration
  CELERY_TASK_ACKS_LATE: "true"
  CELERY_TASK_REJECT_ON_WORKER_LOST: "true"
  CELERY_TASK_TIME_LIMIT: "3600"
  CELERY_TASK_SOFT_TIME_LIMIT: "3300"

  # Celery Beat Configuration
  CELERY_BEAT_SYNC_EVERY: "1"

  # Logging Configuration
  CELERY_LOG_LEVEL: "INFO"
  CELERY_LOG_FORMAT: "json"

  # Performance Configuration
  CELERY_BROKER_POOL_LIMIT: "10"
  CELERY_BROKER_CONNECTION_RETRY: "true"
  CELERY_BROKER_CONNECTION_MAX_RETRIES: "10"

  # Result Backend Configuration
  CELERY_RESULT_EXPIRES: "3600"
  CELERY_RESULT_COMPRESSION: "gzip"

  # Monitoring Configuration
  CELERY_ENABLE_UTC: "true"
  CELERY_TIMEZONE: "UTC"

  # Flower Configuration
  FLOWER_PORT: "5555"
  FLOWER_URL_PREFIX: ""
  FLOWER_PERSISTENT: "true"
  FLOWER_DB: "/app/flower.db"
  FLOWER_MAX_TASKS: "10000"
