apiVersion: 1

contactPoints:
  - name: email-critical
    receivers:
      - uid: email-critical-001
        type: email
        settings:
          addresses: "alerts@toolboxai.com"
          singleEmail: false
        disableResolveMessage: false

  - name: slack-warnings
    receivers:
      - uid: slack-warnings-001
        type: slack
        settings:
          url: "${SLACK_WEBHOOK_URL}"
          title: "ToolboxAI Alert"
          text: "{{ .GroupLabels.alertname }} - {{ .Annotations.summary }}"
        disableResolveMessage: false

  - name: pagerduty-critical
    receivers:
      - uid: pagerduty-critical-001
        type: pagerduty
        settings:
          integrationKey: "${PAGERDUTY_INTEGRATION_KEY}"
          severity: critical
          class: "production"
          component: "toolboxai-backend"
        disableResolveMessage: false

  - name: webhook-all
    receivers:
      - uid: webhook-all-001
        type: webhook
        settings:
          url: "http://localhost:8009/api/v1/monitoring/alerts"
          httpMethod: POST
          username: "grafana"
          password: "${WEBHOOK_PASSWORD}"
        disableResolveMessage: false

policies:
  - receiver: email-critical
    matchers:
      - severity = critical
    continue: true
    muteTimeIntervals: []

  - receiver: slack-warnings
    matchers:
      - severity = warning
    continue: true
    muteTimeIntervals: []

  - receiver: webhook-all
    continue: false
    muteTimeIntervals: []

muteTimeIntervals:
  - name: weekends
    time_intervals:
      - weekdays: ['saturday', 'sunday']

  - name: after-hours
    time_intervals:
      - times:
          - start_time: '18:00'
            end_time: '09:00'
        weekdays: ['monday:friday']

notificationSettings:
  groupWait: 30s
  groupInterval: 5m
  repeatInterval: 12h
  receiver: webhook-all