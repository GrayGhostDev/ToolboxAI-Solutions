<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Comprehensive documentation for the ToolBoxAI educational platform with AI-powered content generation and Roblox integration"><meta name=author content="ToolBoxAI Team"><link href=https://docs.toolboxai.com/05-implementation/agents/supabase-migration/MIGRATION_GUIDE/ rel=canonical><link rel=icon href=../../../../images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.21"><title>ToolBoxAI Supabase Migration Guide - ToolBoxAI Solutions Documentation</title><link rel=stylesheet href=../../../../assets/stylesheets/main.2a3383ac.min.css><link rel=stylesheet href=../../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../css/timeago.css><link rel=stylesheet href=../../../../stylesheets/extra.css><script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-XXXXXXXXXX"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-XXXXXXXXXX",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#toolboxai-supabase-migration-guide class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../.. title="ToolBoxAI Solutions Documentation" class="md-header__button md-logo" aria-label="ToolBoxAI Solutions Documentation" data-md-component=logo> <img src=../../../../images/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> ToolBoxAI Solutions Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> ToolBoxAI Supabase Migration Guide </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=indigo aria-label="Switch to system preference" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ToolBoxAI-Solutions/toolboxai title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> ToolBoxAI-Solutions/toolboxai </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../../01-overview/README.md class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../../../02-architecture/README.md class=md-tabs__link> Architecture </a> </li> <li class=md-tabs__item> <a href=../../../../03-api/README.md class=md-tabs__link> API Documentation </a> </li> <li class=md-tabs__item> <a href=../../../../04-implementation/README.md class=md-tabs__link> Implementation </a> </li> <li class=md-tabs__item> <a href=../../../../05-features/README.md class=md-tabs__link> Features </a> </li> <li class=md-tabs__item> <a href=../../../../06-user-guides/README.md class=md-tabs__link> User Guides </a> </li> <li class=md-tabs__item> <a href=../../../../07-operations/README.md class=md-tabs__link> Operations </a> </li> <li class=md-tabs__item> <a href=../../../../08-reference/README.md class=md-tabs__link> Reference </a> </li> <li class=md-tabs__item> <a href=../../../../09-meta/README.md class=md-tabs__link> Meta </a> </li> <li class=md-tabs__item> <a href=../../../../10-reports/README.md class=md-tabs__link> Reports </a> </li> <li class=md-tabs__item> <a href=../../../../11-sdks/README.md class=md-tabs__link> SDKs </a> </li> <li class=md-tabs__item> <a href=../../../../phase2/ class=md-tabs__link> Phase 2 (Current) </a> </li> <li class=md-tabs__item> <a href=../../../../DOCUMENTATION_AUDIT_REPORT_2025-10-01/ class=md-tabs__link> Audit & Reports </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../.. title="ToolBoxAI Solutions Documentation" class="md-nav__button md-logo" aria-label="ToolBoxAI Solutions Documentation" data-md-component=logo> <img src=../../../../images/logo.png alt=logo> </a> ToolBoxAI Solutions Documentation </label> <div class=md-nav__source> <a href=https://github.com/ToolBoxAI-Solutions/toolboxai title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> ToolBoxAI-Solutions/toolboxai </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../01-overview/README.md class=md-nav__link> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../02-architecture/README.md class=md-nav__link> <span class=md-ellipsis> Architecture </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../03-api/README.md class=md-nav__link> <span class=md-ellipsis> API Documentation </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../04-implementation/README.md class=md-nav__link> <span class=md-ellipsis> Implementation </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../05-features/README.md class=md-nav__link> <span class=md-ellipsis> Features </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../06-user-guides/README.md class=md-nav__link> <span class=md-ellipsis> User Guides </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../07-operations/README.md class=md-nav__link> <span class=md-ellipsis> Operations </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../08-reference/README.md class=md-nav__link> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../09-meta/README.md class=md-nav__link> <span class=md-ellipsis> Meta </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../10-reports/README.md class=md-nav__link> <span class=md-ellipsis> Reports </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../11-sdks/README.md class=md-nav__link> <span class=md-ellipsis> SDKs </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../phase2/ class=md-nav__link> <span class=md-ellipsis> Phase 2 (Current) </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../DOCUMENTATION_AUDIT_REPORT_2025-10-01/ class=md-nav__link> <span class=md-ellipsis> Audit & Reports </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ToolBoxAI-Solutions/toolboxai/edit/main/docs/05-implementation/agents/supabase-migration/MIGRATION_GUIDE.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"/></svg> </a> <a href=https://github.com/ToolBoxAI-Solutions/toolboxai/raw/main/docs/05-implementation/agents/supabase-migration/MIGRATION_GUIDE.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"/></svg> </a> <h1 id=toolboxai-supabase-migration-guide>ToolBoxAI Supabase Migration Guide<a class=headerlink href=#toolboxai-supabase-migration-guide title="Permanent link">&para;</a></h1> <h2 id=table-of-contents>Table of Contents<a class=headerlink href=#table-of-contents title="Permanent link">&para;</a></h2> <ol> <li><a href=#prerequisites>Prerequisites</a></li> <li><a href=#pre-migration-planning>Pre-Migration Planning</a></li> <li><a href=#step-by-step-migration-process>Step-by-Step Migration Process</a></li> <li><a href=#common-migration-scenarios>Common Migration Scenarios</a></li> <li><a href=#troubleshooting>Troubleshooting</a></li> <li><a href=#post-migration-tasks>Post-Migration Tasks</a></li> <li><a href=#best-practices>Best Practices</a></li> </ol> <h2 id=prerequisites>Prerequisites<a class=headerlink href=#prerequisites title="Permanent link">&para;</a></h2> <h3 id=system-requirements>System Requirements<a class=headerlink href=#system-requirements title="Permanent link">&para;</a></h3> <h4 id=software-dependencies>Software Dependencies<a class=headerlink href=#software-dependencies title="Permanent link">&para;</a></h4> <ul> <li><strong>Python</strong>: 3.9 or higher</li> <li><strong>PostgreSQL Client</strong>: psql 12+ for source database access</li> <li><strong>Node.js</strong>: 16+ (for TypeScript type generation)</li> <li><strong>Git</strong>: For version control of migration scripts</li> </ul> <h4 id=python-dependencies>Python Dependencies<a class=headerlink href=#python-dependencies title="Permanent link">&para;</a></h4> <div class="language-bash highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>pip<span class=w> </span>install<span class=w> </span>-r<span class=w> </span>requirements.txt
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=c1># Core dependencies:</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=c1># - asyncpg &gt;= 0.27.0</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=c1># - sqlalchemy &gt;= 1.4.0</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=c1># - supabase &gt;= 1.0.0</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=c1># - langchain &gt;= 0.0.350</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=c1># - pydantic &gt;= 2.0.0</span>
</span></code></pre></div> <h4 id=database-access-requirements>Database Access Requirements<a class=headerlink href=#database-access-requirements title="Permanent link">&para;</a></h4> <p><strong>Source PostgreSQL Database:</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1>-- Create migration user with appropriate permissions</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=k>CREATE</span><span class=w> </span><span class=k>USER</span><span class=w> </span><span class=n>migration_user</span><span class=w> </span><span class=k>WITH</span><span class=w> </span><span class=n>PASSWORD</span><span class=w> </span><span class=s1>&#39;secure_password&#39;</span><span class=p>;</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=c1>-- Grant schema access</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=k>GRANT</span><span class=w> </span><span class=k>USAGE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>SCHEMA</span><span class=w> </span><span class=n>information_schema</span><span class=w> </span><span class=k>TO</span><span class=w> </span><span class=n>migration_user</span><span class=p>;</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=k>GRANT</span><span class=w> </span><span class=k>USAGE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>SCHEMA</span><span class=w> </span><span class=n>pg_catalog</span><span class=w> </span><span class=k>TO</span><span class=w> </span><span class=n>migration_user</span><span class=p>;</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=k>GRANT</span><span class=w> </span><span class=k>USAGE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>SCHEMA</span><span class=w> </span><span class=k>public</span><span class=w> </span><span class=k>TO</span><span class=w> </span><span class=n>migration_user</span><span class=p>;</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=c1>-- Grant read access to all tables</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=k>GRANT</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>ALL</span><span class=w> </span><span class=n>TABLES</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=k>SCHEMA</span><span class=w> </span><span class=n>information_schema</span><span class=w> </span><span class=k>TO</span><span class=w> </span><span class=n>migration_user</span><span class=p>;</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=k>GRANT</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>ALL</span><span class=w> </span><span class=n>TABLES</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=k>SCHEMA</span><span class=w> </span><span class=n>pg_catalog</span><span class=w> </span><span class=k>TO</span><span class=w> </span><span class=n>migration_user</span><span class=p>;</span>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=k>GRANT</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>ALL</span><span class=w> </span><span class=n>TABLES</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=k>SCHEMA</span><span class=w> </span><span class=k>public</span><span class=w> </span><span class=k>TO</span><span class=w> </span><span class=n>migration_user</span><span class=p>;</span>
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a>
</span><span id=__span-1-14><a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=c1>-- Grant access to sequences</span>
</span><span id=__span-1-15><a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a><span class=k>GRANT</span><span class=w> </span><span class=k>USAGE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>ALL</span><span class=w> </span><span class=n>SEQUENCES</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=k>SCHEMA</span><span class=w> </span><span class=k>public</span><span class=w> </span><span class=k>TO</span><span class=w> </span><span class=n>migration_user</span><span class=p>;</span>
</span><span id=__span-1-16><a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a>
</span><span id=__span-1-17><a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a><span class=c1>-- For data export (if needed)</span>
</span><span id=__span-1-18><a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a><span class=k>GRANT</span><span class=w> </span><span class=k>CONNECT</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=n>your_database</span><span class=w> </span><span class=k>TO</span><span class=w> </span><span class=n>migration_user</span><span class=p>;</span>
</span></code></pre></div></p> <p><strong>Target Supabase Project:</strong> - Supabase project URL - Service role key (for admin operations) - Database password - Sufficient storage quota for data volume</p> <h3 id=environment-setup>Environment Setup<a class=headerlink href=#environment-setup title="Permanent link">&para;</a></h3> <h4 id=environment-variables>Environment Variables<a class=headerlink href=#environment-variables title="Permanent link">&para;</a></h4> <p>Create a <code>.env</code> file with the following configuration:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1># Source Database Configuration</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=nv>SOURCE_DATABASE_URL</span><span class=o>=</span>postgresql://migration_user:password@localhost:5432/source_db
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=nv>SOURCE_DATABASE_NAME</span><span class=o>=</span>your_app_production
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=c1># Supabase Configuration</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=nv>SUPABASE_URL</span><span class=o>=</span>https://your-project-id.supabase.co
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=nv>SUPABASE_ANON_KEY</span><span class=o>=</span>your_anon_key
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=nv>SUPABASE_SERVICE_ROLE_KEY</span><span class=o>=</span>your_service_role_key
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=nv>SUPABASE_DB_PASSWORD</span><span class=o>=</span>your_db_password
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=c1># Migration Configuration</span>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=nv>MIGRATION_BATCH_SIZE</span><span class=o>=</span><span class=m>1000</span>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a><span class=nv>MIGRATION_PARALLEL_WORKERS</span><span class=o>=</span><span class=m>4</span>
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a><span class=nv>MIGRATION_TIMEOUT_SECONDS</span><span class=o>=</span><span class=m>3600</span>
</span><span id=__span-2-15><a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a><span class=nv>ENABLE_DRY_RUN</span><span class=o>=</span><span class=nb>true</span>
</span><span id=__span-2-16><a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a>
</span><span id=__span-2-17><a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a><span class=c1># AI Configuration (Optional)</span>
</span><span id=__span-2-18><a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a><span class=nv>OPENAI_API_KEY</span><span class=o>=</span>your_openai_key
</span><span id=__span-2-19><a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a><span class=nv>USE_MOCK_LLM</span><span class=o>=</span><span class=nb>false</span>
</span><span id=__span-2-20><a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a>
</span><span id=__span-2-21><a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a><span class=c1># Logging Configuration</span>
</span><span id=__span-2-22><a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a><span class=nv>LOG_LEVEL</span><span class=o>=</span>INFO
</span><span id=__span-2-23><a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a><span class=nv>LOG_FILE</span><span class=o>=</span>migration.log
</span><span id=__span-2-24><a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a><span class=nv>ENABLE_DETAILED_LOGGING</span><span class=o>=</span><span class=nb>true</span>
</span></code></pre></div> <h4 id=directory-structure>Directory Structure<a class=headerlink href=#directory-structure title="Permanent link">&para;</a></h4> <div class="language-text highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>migration-workspace/
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>├── .env                    # Environment configuration
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>├── migration_config.yaml  # Migration-specific settings
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>├── backups/               # Database backups
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>├── logs/                  # Migration logs
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>├── scripts/               # Generated migration scripts
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a>├── validation/            # Validation test results
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a>└── rollback/              # Rollback procedures
</span></code></pre></div> <h2 id=pre-migration-planning>Pre-Migration Planning<a class=headerlink href=#pre-migration-planning title="Permanent link">&para;</a></h2> <h3 id=1-database-assessment>1. Database Assessment<a class=headerlink href=#1-database-assessment title="Permanent link">&para;</a></h3> <h4 id=compatibility-check>Compatibility Check<a class=headerlink href=#compatibility-check title="Permanent link">&para;</a></h4> <p>Run the compatibility assessment tool:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=kn>from</span><span class=w> </span><span class=nn>core.agents.supabase</span><span class=w> </span><span class=kn>import</span> <span class=n>SupabaseMigrationAgent</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=n>agent</span> <span class=o>=</span> <span class=n>SupabaseMigrationAgent</span><span class=p>()</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=c1># Perform initial assessment</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=n>assessment</span> <span class=o>=</span> <span class=k>await</span> <span class=n>agent</span><span class=o>.</span><span class=n>assess_compatibility</span><span class=p>(</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a>    <span class=n>connection_string</span><span class=o>=</span><span class=n>SOURCE_DATABASE_URL</span><span class=p>,</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a>    <span class=n>target_platform</span><span class=o>=</span><span class=s2>&quot;supabase&quot;</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=p>)</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Compatibility Score: </span><span class=si>{</span><span class=n>assessment</span><span class=p>[</span><span class=s1>&#39;score&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>/100&quot;</span><span class=p>)</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Blockers: </span><span class=si>{</span><span class=n>assessment</span><span class=p>[</span><span class=s1>&#39;blockers&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Warnings: </span><span class=si>{</span><span class=n>assessment</span><span class=p>[</span><span class=s1>&#39;warnings&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span></code></pre></div> <h4 id=data-inventory>Data Inventory<a class=headerlink href=#data-inventory title="Permanent link">&para;</a></h4> <p>Create an inventory of your data:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=c1># Generate database statistics</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>python<span class=w> </span>scripts/generate_inventory.py<span class=w> </span>--source<span class=w> </span><span class=nv>$SOURCE_DATABASE_URL</span><span class=w> </span>--output<span class=w> </span>inventory.json
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=c1># Example output structure:</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=o>{</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=w>    </span><span class=s2>&quot;tables&quot;</span>:<span class=w> </span><span class=o>{</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=w>        </span><span class=s2>&quot;users&quot;</span>:<span class=w> </span><span class=o>{</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=w>            </span><span class=s2>&quot;row_count&quot;</span>:<span class=w> </span><span class=m>10000</span>,
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=w>            </span><span class=s2>&quot;size_mb&quot;</span>:<span class=w> </span><span class=m>15</span>.2,
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=w>            </span><span class=s2>&quot;has_sensitive_data&quot;</span>:<span class=w> </span>true,
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=w>            </span><span class=s2>&quot;dependent_tables&quot;</span>:<span class=w> </span><span class=o>[</span><span class=s2>&quot;profiles&quot;</span>,<span class=w> </span><span class=s2>&quot;sessions&quot;</span><span class=o>]</span>
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=w>        </span><span class=o>}</span>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=w>    </span><span class=o>}</span>,
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a><span class=w>    </span><span class=s2>&quot;total_size_gb&quot;</span>:<span class=w> </span><span class=m>2</span>.5,
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a><span class=w>    </span><span class=s2>&quot;estimated_migration_time&quot;</span>:<span class=w> </span><span class=s2>&quot;4-6 hours&quot;</span>
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a><span class=o>}</span>
</span></code></pre></div> <h3 id=2-migration-strategy-selection>2. Migration Strategy Selection<a class=headerlink href=#2-migration-strategy-selection title="Permanent link">&para;</a></h3> <p>Choose the appropriate migration strategy based on your requirements:</p> <h4 id=strategy-1-big-bang-migration>Strategy 1: Big Bang Migration<a class=headerlink href=#strategy-1-big-bang-migration title="Permanent link">&para;</a></h4> <p><strong>Best for:</strong> - Small to medium databases (&lt; 1GB) - Applications that can tolerate downtime - Simple schema structures</p> <p><strong>Timeline:</strong> 2-8 hours <strong>Downtime:</strong> Full downtime during migration</p> <h4 id=strategy-2-phased-migration>Strategy 2: Phased Migration<a class=headerlink href=#strategy-2-phased-migration title="Permanent link">&para;</a></h4> <p><strong>Best for:</strong> - Large databases (&gt; 1GB) - Complex schema with many dependencies - Applications requiring minimal downtime</p> <p><strong>Timeline:</strong> 1-2 weeks <strong>Downtime:</strong> Minimal (cutover period only)</p> <h4 id=strategy-3-blue-green-migration>Strategy 3: Blue-Green Migration<a class=headerlink href=#strategy-3-blue-green-migration title="Permanent link">&para;</a></h4> <p><strong>Best for:</strong> - Mission-critical applications - Zero-downtime requirements - Applications with read-heavy workloads</p> <p><strong>Timeline:</strong> 2-3 weeks <strong>Downtime:</strong> Near-zero (DNS switch only)</p> <h3 id=3-risk-assessment>3. Risk Assessment<a class=headerlink href=#3-risk-assessment title="Permanent link">&para;</a></h3> <h4 id=identify-high-risk-elements>Identify High-Risk Elements<a class=headerlink href=#identify-high-risk-elements title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=c1># Automated risk assessment</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=n>risk_assessment</span> <span class=o>=</span> <span class=k>await</span> <span class=n>agent</span><span class=o>.</span><span class=n>assess_migration_risks</span><span class=p>(</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>    <span class=n>analysis_results</span><span class=o>=</span><span class=n>analysis</span><span class=p>,</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>    <span class=n>migration_strategy</span><span class=o>=</span><span class=s2>&quot;phased&quot;</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=p>)</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=c1># Example risk factors:</span>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=p>{</span>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a>    <span class=s2>&quot;high_risk&quot;</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a>        <span class=s2>&quot;Large JSONB columns (may require restructuring)&quot;</span><span class=p>,</span>
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a>        <span class=s2>&quot;Complex stored procedures (need Edge Function conversion)&quot;</span><span class=p>,</span>
</span><span id=__span-6-12><a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a>        <span class=s2>&quot;Custom data types (may need mapping)&quot;</span>
</span><span id=__span-6-13><a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a>    <span class=p>],</span>
</span><span id=__span-6-14><a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a>    <span class=s2>&quot;medium_risk&quot;</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-6-15><a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a>        <span class=s2>&quot;Large tables (may require batched migration)&quot;</span><span class=p>,</span>
</span><span id=__span-6-16><a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a>        <span class=s2>&quot;Complex foreign key relationships&quot;</span>
</span><span id=__span-6-17><a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a>    <span class=p>],</span>
</span><span id=__span-6-18><a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a>    <span class=s2>&quot;low_risk&quot;</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-6-19><a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a>        <span class=s2>&quot;Simple table structures&quot;</span><span class=p>,</span>
</span><span id=__span-6-20><a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a>        <span class=s2>&quot;Standard data types&quot;</span>
</span><span id=__span-6-21><a id=__codelineno-6-21 name=__codelineno-6-21 href=#__codelineno-6-21></a>    <span class=p>],</span>
</span><span id=__span-6-22><a id=__codelineno-6-22 name=__codelineno-6-22 href=#__codelineno-6-22></a>    <span class=s2>&quot;mitigation_strategies&quot;</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-6-23><a id=__codelineno-6-23 name=__codelineno-6-23 href=#__codelineno-6-23></a>        <span class=s2>&quot;Create rollback procedures for each phase&quot;</span><span class=p>,</span>
</span><span id=__span-6-24><a id=__codelineno-6-24 name=__codelineno-6-24 href=#__codelineno-6-24></a>        <span class=s2>&quot;Implement comprehensive testing&quot;</span><span class=p>,</span>
</span><span id=__span-6-25><a id=__codelineno-6-25 name=__codelineno-6-25 href=#__codelineno-6-25></a>        <span class=s2>&quot;Use progressive data migration&quot;</span>
</span><span id=__span-6-26><a id=__codelineno-6-26 name=__codelineno-6-26 href=#__codelineno-6-26></a>    <span class=p>]</span>
</span><span id=__span-6-27><a id=__codelineno-6-27 name=__codelineno-6-27 href=#__codelineno-6-27></a><span class=p>}</span>
</span></code></pre></div> <h2 id=step-by-step-migration-process>Step-by-Step Migration Process<a class=headerlink href=#step-by-step-migration-process title="Permanent link">&para;</a></h2> <h3 id=phase-1-pre-migration-setup>Phase 1: Pre-Migration Setup<a class=headerlink href=#phase-1-pre-migration-setup title="Permanent link">&para;</a></h3> <h4 id=step-1-create-backups>Step 1: Create Backups<a class=headerlink href=#step-1-create-backups title="Permanent link">&para;</a></h4> <div class="language-bash highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=c1># Create full database backup</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>pg_dump<span class=w> </span>-h<span class=w> </span>localhost<span class=w> </span>-U<span class=w> </span>migration_user<span class=w> </span>-d<span class=w> </span>source_db<span class=w> </span>&gt;<span class=w> </span>backups/pre_migration_backup.sql
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=c1># Create schema-only backup</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>pg_dump<span class=w> </span>-h<span class=w> </span>localhost<span class=w> </span>-U<span class=w> </span>migration_user<span class=w> </span>-d<span class=w> </span>source_db<span class=w> </span>--schema-only<span class=w> </span>&gt;<span class=w> </span>backups/schema_backup.sql
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=c1># Verify backup integrity</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a>psql<span class=w> </span>-h<span class=w> </span>localhost<span class=w> </span>-U<span class=w> </span>migration_user<span class=w> </span>-d<span class=w> </span>test_restore_db<span class=w> </span>&lt;<span class=w> </span>backups/pre_migration_backup.sql
</span></code></pre></div> <h4 id=step-2-set-up-supabase-project>Step 2: Set Up Supabase Project<a class=headerlink href=#step-2-set-up-supabase-project title="Permanent link">&para;</a></h4> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=c1>// Initialize Supabase project</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>createClient</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s1>&#39;@supabase/supabase-js&#39;</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=kd>const</span><span class=w> </span><span class=nx>supabase</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createClient</span><span class=p>(</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=w>  </span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>SUPABASE_URL</span><span class=p>,</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=w>  </span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>SUPABASE_SERVICE_ROLE_KEY</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=p>)</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=c1>// Verify connectivity</span>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>error</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>supabase</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=s1>&#39;_test&#39;</span><span class=p>).</span><span class=nx>select</span><span class=p>(</span><span class=s1>&#39;*&#39;</span><span class=p>).</span><span class=nx>limit</span><span class=p>(</span><span class=mf>1</span><span class=p>)</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>error</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nx>error</span><span class=p>.</span><span class=nx>code</span><span class=w> </span><span class=o>!==</span><span class=w> </span><span class=s1>&#39;PGRST116&#39;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Supabase connection failed:&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>error</span><span class=p>)</span>
</span><span id=__span-8-13><a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-14><a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Supabase connection successful&#39;</span><span class=p>)</span>
</span><span id=__span-8-15><a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a><span class=p>}</span>
</span></code></pre></div> <h4 id=step-3-configure-migration-environment>Step 3: Configure Migration Environment<a class=headerlink href=#step-3-configure-migration-environment title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=c1># Create migration configuration</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=n>migration_config</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>    <span class=s2>&quot;source&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>        <span class=s2>&quot;connection_string&quot;</span><span class=p>:</span> <span class=n>SOURCE_DATABASE_URL</span><span class=p>,</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a>        <span class=s2>&quot;database_name&quot;</span><span class=p>:</span> <span class=n>SOURCE_DATABASE_NAME</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a>    <span class=p>},</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a>    <span class=s2>&quot;target&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a>        <span class=s2>&quot;supabase_url&quot;</span><span class=p>:</span> <span class=n>SUPABASE_URL</span><span class=p>,</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a>        <span class=s2>&quot;service_role_key&quot;</span><span class=p>:</span> <span class=n>SUPABASE_SERVICE_ROLE_KEY</span>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a>    <span class=p>},</span>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a>    <span class=s2>&quot;options&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a>        <span class=s2>&quot;batch_size&quot;</span><span class=p>:</span> <span class=mi>1000</span><span class=p>,</span>
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a>        <span class=s2>&quot;parallel_workers&quot;</span><span class=p>:</span> <span class=mi>4</span><span class=p>,</span>
</span><span id=__span-9-14><a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a>        <span class=s2>&quot;enable_compression&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-9-15><a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a>        <span class=s2>&quot;preserve_timestamps&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-9-16><a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a>        <span class=s2>&quot;validate_data_integrity&quot;</span><span class=p>:</span> <span class=kc>True</span>
</span><span id=__span-9-17><a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a>    <span class=p>},</span>
</span><span id=__span-9-18><a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a>    <span class=s2>&quot;exclusions&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-9-19><a id=__codelineno-9-19 name=__codelineno-9-19 href=#__codelineno-9-19></a>        <span class=s2>&quot;tables&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;temp_data&quot;</span><span class=p>,</span> <span class=s2>&quot;cache_*&quot;</span><span class=p>],</span>
</span><span id=__span-9-20><a id=__codelineno-9-20 name=__codelineno-9-20 href=#__codelineno-9-20></a>        <span class=s2>&quot;schemas&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;information_schema&quot;</span><span class=p>,</span> <span class=s2>&quot;pg_catalog&quot;</span><span class=p>]</span>
</span><span id=__span-9-21><a id=__codelineno-9-21 name=__codelineno-9-21 href=#__codelineno-9-21></a>    <span class=p>}</span>
</span><span id=__span-9-22><a id=__codelineno-9-22 name=__codelineno-9-22 href=#__codelineno-9-22></a><span class=p>}</span>
</span><span id=__span-9-23><a id=__codelineno-9-23 name=__codelineno-9-23 href=#__codelineno-9-23></a>
</span><span id=__span-9-24><a id=__codelineno-9-24 name=__codelineno-9-24 href=#__codelineno-9-24></a><span class=c1># Save configuration</span>
</span><span id=__span-9-25><a id=__codelineno-9-25 name=__codelineno-9-25 href=#__codelineno-9-25></a><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;migration_config.yaml&#39;</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-9-26><a id=__codelineno-9-26 name=__codelineno-9-26 href=#__codelineno-9-26></a>    <span class=n>yaml</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=n>migration_config</span><span class=p>,</span> <span class=n>f</span><span class=p>)</span>
</span></code></pre></div> <h3 id=phase-2-analysis-and-planning>Phase 2: Analysis and Planning<a class=headerlink href=#phase-2-analysis-and-planning title="Permanent link">&para;</a></h3> <h4 id=step-4-comprehensive-database-analysis>Step 4: Comprehensive Database Analysis<a class=headerlink href=#step-4-comprehensive-database-analysis title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=kn>from</span><span class=w> </span><span class=nn>core.agents.supabase</span><span class=w> </span><span class=kn>import</span> <span class=n>SupabaseMigrationAgent</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>perform_analysis</span><span class=p>():</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>    <span class=n>agent</span> <span class=o>=</span> <span class=n>SupabaseMigrationAgent</span><span class=p>()</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a>    <span class=c1># Comprehensive analysis</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a>    <span class=n>analysis</span> <span class=o>=</span> <span class=k>await</span> <span class=n>agent</span><span class=o>.</span><span class=n>analyze_database</span><span class=p>(</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a>        <span class=n>connection_string</span><span class=o>=</span><span class=n>SOURCE_DATABASE_URL</span><span class=p>,</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>        <span class=n>database_name</span><span class=o>=</span><span class=n>SOURCE_DATABASE_NAME</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>    <span class=p>)</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a>    <span class=c1># Save analysis results</span>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;analysis_results.json&#39;</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a>        <span class=n>json</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=n>analysis</span><span class=p>,</span> <span class=n>f</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=nb>str</span><span class=p>)</span>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a>
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a>    <span class=c1># Generate analysis report</span>
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a>    <span class=n>report</span> <span class=o>=</span> <span class=n>generate_analysis_report</span><span class=p>(</span><span class=n>analysis</span><span class=p>)</span>
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a>    <span class=nb>print</span><span class=p>(</span><span class=n>report</span><span class=p>)</span>
</span><span id=__span-10-19><a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a>
</span><span id=__span-10-20><a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a>    <span class=k>return</span> <span class=n>analysis</span>
</span><span id=__span-10-21><a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a>
</span><span id=__span-10-22><a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a><span class=c1># Run analysis</span>
</span><span id=__span-10-23><a id=__codelineno-10-23 name=__codelineno-10-23 href=#__codelineno-10-23></a><span class=n>analysis</span> <span class=o>=</span> <span class=k>await</span> <span class=n>perform_analysis</span><span class=p>()</span>
</span></code></pre></div> <h4 id=step-5-generate-migration-plan>Step 5: Generate Migration Plan<a class=headerlink href=#step-5-generate-migration-plan title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>create_migration_plan</span><span class=p>(</span><span class=n>analysis</span><span class=p>):</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>    <span class=n>agent</span> <span class=o>=</span> <span class=n>SupabaseMigrationAgent</span><span class=p>()</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>    <span class=c1># Generate comprehensive migration plan</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>    <span class=n>plan</span> <span class=o>=</span> <span class=k>await</span> <span class=n>agent</span><span class=o>.</span><span class=n>generate_migration_plan</span><span class=p>(</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>        <span class=n>analysis_results</span><span class=o>=</span><span class=n>analysis</span><span class=p>,</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a>        <span class=n>migration_options</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>            <span class=s2>&quot;enable_realtime&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a>            <span class=s2>&quot;vector_dimensions&quot;</span><span class=p>:</span> <span class=mi>1536</span><span class=p>,</span>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>            <span class=s2>&quot;multi_tenant&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a>            <span class=s2>&quot;batch_size&quot;</span><span class=p>:</span> <span class=mi>1000</span><span class=p>,</span>
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a>            <span class=s2>&quot;rls_strategy&quot;</span><span class=p>:</span> <span class=s2>&quot;role_based&quot;</span><span class=p>,</span>
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a>            <span class=s2>&quot;preserve_constraints&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-11-14><a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a>            <span class=s2>&quot;optimize_indexes&quot;</span><span class=p>:</span> <span class=kc>True</span>
</span><span id=__span-11-15><a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a>        <span class=p>}</span>
</span><span id=__span-11-16><a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a>    <span class=p>)</span>
</span><span id=__span-11-17><a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a>
</span><span id=__span-11-18><a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a>    <span class=c1># Review and customize plan</span>
</span><span id=__span-11-19><a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Migration Plan Summary:&quot;</span><span class=p>)</span>
</span><span id=__span-11-20><a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;- Tables to migrate: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>plan</span><span class=o>.</span><span class=n>schema_mappings</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-11-21><a id=__codelineno-11-21 name=__codelineno-11-21 href=#__codelineno-11-21></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;- RLS policies: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>plan</span><span class=o>.</span><span class=n>rls_policies</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-11-22><a id=__codelineno-11-22 name=__codelineno-11-22 href=#__codelineno-11-22></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;- Data migrations: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>plan</span><span class=o>.</span><span class=n>data_migrations</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-11-23><a id=__codelineno-11-23 name=__codelineno-11-23 href=#__codelineno-11-23></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;- Estimated duration: </span><span class=si>{</span><span class=n>plan</span><span class=o>.</span><span class=n>estimated_duration</span><span class=si>}</span><span class=s2> minutes&quot;</span><span class=p>)</span>
</span><span id=__span-11-24><a id=__codelineno-11-24 name=__codelineno-11-24 href=#__codelineno-11-24></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;- Risk level: </span><span class=si>{</span><span class=n>plan</span><span class=o>.</span><span class=n>risk_assessment</span><span class=p>[</span><span class=s1>&#39;level&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-11-25><a id=__codelineno-11-25 name=__codelineno-11-25 href=#__codelineno-11-25></a>
</span><span id=__span-11-26><a id=__codelineno-11-26 name=__codelineno-11-26 href=#__codelineno-11-26></a>    <span class=c1># Save plan for review</span>
</span><span id=__span-11-27><a id=__codelineno-11-27 name=__codelineno-11-27 href=#__codelineno-11-27></a>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;migration_plan.json&#39;</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-11-28><a id=__codelineno-11-28 name=__codelineno-11-28 href=#__codelineno-11-28></a>        <span class=n>json</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=n>asdict</span><span class=p>(</span><span class=n>plan</span><span class=p>),</span> <span class=n>f</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=nb>str</span><span class=p>)</span>
</span><span id=__span-11-29><a id=__codelineno-11-29 name=__codelineno-11-29 href=#__codelineno-11-29></a>
</span><span id=__span-11-30><a id=__codelineno-11-30 name=__codelineno-11-30 href=#__codelineno-11-30></a>    <span class=k>return</span> <span class=n>plan</span>
</span><span id=__span-11-31><a id=__codelineno-11-31 name=__codelineno-11-31 href=#__codelineno-11-31></a>
</span><span id=__span-11-32><a id=__codelineno-11-32 name=__codelineno-11-32 href=#__codelineno-11-32></a><span class=c1># Generate plan</span>
</span><span id=__span-11-33><a id=__codelineno-11-33 name=__codelineno-11-33 href=#__codelineno-11-33></a><span class=n>plan</span> <span class=o>=</span> <span class=k>await</span> <span class=n>create_migration_plan</span><span class=p>(</span><span class=n>analysis</span><span class=p>)</span>
</span></code></pre></div> <h3 id=phase-3-dry-run-execution>Phase 3: Dry Run Execution<a class=headerlink href=#phase-3-dry-run-execution title="Permanent link">&para;</a></h3> <h4 id=step-6-execute-dry-run>Step 6: Execute Dry Run<a class=headerlink href=#step-6-execute-dry-run title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>execute_dry_run</span><span class=p>(</span><span class=n>plan</span><span class=p>):</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>    <span class=n>agent</span> <span class=o>=</span> <span class=n>SupabaseMigrationAgent</span><span class=p>()</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Starting dry run migration...&quot;</span><span class=p>)</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>    <span class=c1># Execute dry run</span>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a>    <span class=n>dry_results</span> <span class=o>=</span> <span class=k>await</span> <span class=n>agent</span><span class=o>.</span><span class=n>execute_migration</span><span class=p>(</span>
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a>        <span class=n>plan</span><span class=o>=</span><span class=n>plan</span><span class=p>,</span>
</span><span id=__span-12-9><a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a>        <span class=n>dry_run</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-12-10><a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a>    <span class=p>)</span>
</span><span id=__span-12-11><a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a>
</span><span id=__span-12-12><a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a>    <span class=c1># Analyze dry run results</span>
</span><span id=__span-12-13><a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a>    <span class=k>if</span> <span class=n>dry_results</span><span class=p>[</span><span class=s1>&#39;status&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;completed&#39;</span><span class=p>:</span>
</span><span id=__span-12-14><a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Dry run completed successfully!&quot;</span><span class=p>)</span>
</span><span id=__span-12-15><a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a>
</span><span id=__span-12-16><a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a>        <span class=c1># Review each phase</span>
</span><span id=__span-12-17><a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a>        <span class=k>for</span> <span class=n>step</span> <span class=ow>in</span> <span class=n>dry_results</span><span class=p>[</span><span class=s1>&#39;steps&#39;</span><span class=p>]:</span>
</span><span id=__span-12-18><a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✓ </span><span class=si>{</span><span class=n>step</span><span class=p>[</span><span class=s1>&#39;step&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>step</span><span class=p>[</span><span class=s1>&#39;status&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-12-19><a id=__codelineno-12-19 name=__codelineno-12-19 href=#__codelineno-12-19></a>            <span class=k>if</span> <span class=n>step</span><span class=p>[</span><span class=s1>&#39;status&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;failed&#39;</span><span class=p>:</span>
</span><span id=__span-12-20><a id=__codelineno-12-20 name=__codelineno-12-20 href=#__codelineno-12-20></a>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  Error: </span><span class=si>{</span><span class=n>step</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-12-21><a id=__codelineno-12-21 name=__codelineno-12-21 href=#__codelineno-12-21></a>
</span><span id=__span-12-22><a id=__codelineno-12-22 name=__codelineno-12-22 href=#__codelineno-12-22></a>        <span class=k>return</span> <span class=kc>True</span>
</span><span id=__span-12-23><a id=__codelineno-12-23 name=__codelineno-12-23 href=#__codelineno-12-23></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-12-24><a id=__codelineno-12-24 name=__codelineno-12-24 href=#__codelineno-12-24></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Dry run failed: </span><span class=si>{</span><span class=n>dry_results</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-12-25><a id=__codelineno-12-25 name=__codelineno-12-25 href=#__codelineno-12-25></a>
</span><span id=__span-12-26><a id=__codelineno-12-26 name=__codelineno-12-26 href=#__codelineno-12-26></a>        <span class=c1># Analyze failure points</span>
</span><span id=__span-12-27><a id=__codelineno-12-27 name=__codelineno-12-27 href=#__codelineno-12-27></a>        <span class=k>for</span> <span class=n>step</span> <span class=ow>in</span> <span class=n>dry_results</span><span class=p>[</span><span class=s1>&#39;steps&#39;</span><span class=p>]:</span>
</span><span id=__span-12-28><a id=__codelineno-12-28 name=__codelineno-12-28 href=#__codelineno-12-28></a>            <span class=k>if</span> <span class=n>step</span><span class=p>[</span><span class=s1>&#39;status&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;failed&#39;</span><span class=p>:</span>
</span><span id=__span-12-29><a id=__codelineno-12-29 name=__codelineno-12-29 href=#__codelineno-12-29></a>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Failed step: </span><span class=si>{</span><span class=n>step</span><span class=p>[</span><span class=s1>&#39;step&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-12-30><a id=__codelineno-12-30 name=__codelineno-12-30 href=#__codelineno-12-30></a>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error: </span><span class=si>{</span><span class=n>step</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-12-31><a id=__codelineno-12-31 name=__codelineno-12-31 href=#__codelineno-12-31></a>
</span><span id=__span-12-32><a id=__codelineno-12-32 name=__codelineno-12-32 href=#__codelineno-12-32></a>        <span class=k>return</span> <span class=kc>False</span>
</span><span id=__span-12-33><a id=__codelineno-12-33 name=__codelineno-12-33 href=#__codelineno-12-33></a>
</span><span id=__span-12-34><a id=__codelineno-12-34 name=__codelineno-12-34 href=#__codelineno-12-34></a><span class=c1># Execute dry run</span>
</span><span id=__span-12-35><a id=__codelineno-12-35 name=__codelineno-12-35 href=#__codelineno-12-35></a><span class=n>dry_run_success</span> <span class=o>=</span> <span class=k>await</span> <span class=n>execute_dry_run</span><span class=p>(</span><span class=n>plan</span><span class=p>)</span>
</span><span id=__span-12-36><a id=__codelineno-12-36 name=__codelineno-12-36 href=#__codelineno-12-36></a>
</span><span id=__span-12-37><a id=__codelineno-12-37 name=__codelineno-12-37 href=#__codelineno-12-37></a><span class=k>if</span> <span class=ow>not</span> <span class=n>dry_run_success</span><span class=p>:</span>
</span><span id=__span-12-38><a id=__codelineno-12-38 name=__codelineno-12-38 href=#__codelineno-12-38></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Please address dry run issues before proceeding&quot;</span><span class=p>)</span>
</span><span id=__span-12-39><a id=__codelineno-12-39 name=__codelineno-12-39 href=#__codelineno-12-39></a>    <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></code></pre></div> <h3 id=phase-4-schema-migration>Phase 4: Schema Migration<a class=headerlink href=#phase-4-schema-migration title="Permanent link">&para;</a></h3> <h4 id=step-7-migrate-database-schema>Step 7: Migrate Database Schema<a class=headerlink href=#step-7-migrate-database-schema title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>migrate_schema</span><span class=p>(</span><span class=n>plan</span><span class=p>):</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>    <span class=n>agent</span> <span class=o>=</span> <span class=n>SupabaseMigrationAgent</span><span class=p>()</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Migrating database schema...&quot;</span><span class=p>)</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a>    <span class=c1># Execute schema migration only</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a>    <span class=n>schema_results</span> <span class=o>=</span> <span class=k>await</span> <span class=n>agent</span><span class=o>.</span><span class=n>execute_schema_migration</span><span class=p>(</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a>        <span class=n>plan</span><span class=o>=</span><span class=n>plan</span><span class=p>,</span>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a>        <span class=n>dry_run</span><span class=o>=</span><span class=kc>False</span>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a>    <span class=p>)</span>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a>
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a>    <span class=k>if</span> <span class=n>schema_results</span><span class=p>[</span><span class=s1>&#39;status&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;completed&#39;</span><span class=p>:</span>
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Schema migration completed successfully!&quot;</span><span class=p>)</span>
</span><span id=__span-13-14><a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a>
</span><span id=__span-13-15><a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a>        <span class=c1># Verify schema structure</span>
</span><span id=__span-13-16><a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a>        <span class=n>verification</span> <span class=o>=</span> <span class=k>await</span> <span class=n>agent</span><span class=o>.</span><span class=n>verify_schema_migration</span><span class=p>(</span>
</span><span id=__span-13-17><a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a>            <span class=n>source_connection</span><span class=o>=</span><span class=n>SOURCE_DATABASE_URL</span><span class=p>,</span>
</span><span id=__span-13-18><a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a>            <span class=n>target_connection</span><span class=o>=</span><span class=n>SUPABASE_CONNECTION_STRING</span>
</span><span id=__span-13-19><a id=__codelineno-13-19 name=__codelineno-13-19 href=#__codelineno-13-19></a>        <span class=p>)</span>
</span><span id=__span-13-20><a id=__codelineno-13-20 name=__codelineno-13-20 href=#__codelineno-13-20></a>
</span><span id=__span-13-21><a id=__codelineno-13-21 name=__codelineno-13-21 href=#__codelineno-13-21></a>        <span class=k>if</span> <span class=n>verification</span><span class=p>[</span><span class=s1>&#39;schema_match&#39;</span><span class=p>]:</span>
</span><span id=__span-13-22><a id=__codelineno-13-22 name=__codelineno-13-22 href=#__codelineno-13-22></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Schema verification passed!&quot;</span><span class=p>)</span>
</span><span id=__span-13-23><a id=__codelineno-13-23 name=__codelineno-13-23 href=#__codelineno-13-23></a>            <span class=k>return</span> <span class=kc>True</span>
</span><span id=__span-13-24><a id=__codelineno-13-24 name=__codelineno-13-24 href=#__codelineno-13-24></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-13-25><a id=__codelineno-13-25 name=__codelineno-13-25 href=#__codelineno-13-25></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Schema verification failed!&quot;</span><span class=p>)</span>
</span><span id=__span-13-26><a id=__codelineno-13-26 name=__codelineno-13-26 href=#__codelineno-13-26></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Mismatches: </span><span class=si>{</span><span class=n>verification</span><span class=p>[</span><span class=s1>&#39;mismatches&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-13-27><a id=__codelineno-13-27 name=__codelineno-13-27 href=#__codelineno-13-27></a>            <span class=k>return</span> <span class=kc>False</span>
</span><span id=__span-13-28><a id=__codelineno-13-28 name=__codelineno-13-28 href=#__codelineno-13-28></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-13-29><a id=__codelineno-13-29 name=__codelineno-13-29 href=#__codelineno-13-29></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Schema migration failed: </span><span class=si>{</span><span class=n>schema_results</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-13-30><a id=__codelineno-13-30 name=__codelineno-13-30 href=#__codelineno-13-30></a>        <span class=k>return</span> <span class=kc>False</span>
</span><span id=__span-13-31><a id=__codelineno-13-31 name=__codelineno-13-31 href=#__codelineno-13-31></a>
</span><span id=__span-13-32><a id=__codelineno-13-32 name=__codelineno-13-32 href=#__codelineno-13-32></a><span class=c1># Execute schema migration</span>
</span><span id=__span-13-33><a id=__codelineno-13-33 name=__codelineno-13-33 href=#__codelineno-13-33></a><span class=n>schema_success</span> <span class=o>=</span> <span class=k>await</span> <span class=n>migrate_schema</span><span class=p>(</span><span class=n>plan</span><span class=p>)</span>
</span></code></pre></div> <h4 id=step-8-apply-rls-policies>Step 8: Apply RLS Policies<a class=headerlink href=#step-8-apply-rls-policies title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>apply_rls_policies</span><span class=p>(</span><span class=n>plan</span><span class=p>):</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>    <span class=kn>from</span><span class=w> </span><span class=nn>core.agents.supabase.tools</span><span class=w> </span><span class=kn>import</span> <span class=n>RLSPolicyGeneratorTool</span>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a>    <span class=n>rls_tool</span> <span class=o>=</span> <span class=n>RLSPolicyGeneratorTool</span><span class=p>()</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Applying RLS policies...&quot;</span><span class=p>)</span>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a>    <span class=c1># Generate SQL for RLS policies</span>
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a>    <span class=n>rls_sql</span> <span class=o>=</span> <span class=n>rls_tool</span><span class=o>.</span><span class=n>generate_sql</span><span class=p>(</span><span class=n>plan</span><span class=o>.</span><span class=n>rls_policies</span><span class=p>)</span>
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a>
</span><span id=__span-14-11><a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a>    <span class=c1># Apply policies to Supabase</span>
</span><span id=__span-14-12><a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-14-13><a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a>        <span class=n>supabase</span> <span class=o>=</span> <span class=n>create_supabase_client</span><span class=p>()</span>
</span><span id=__span-14-14><a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a>
</span><span id=__span-14-15><a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a>        <span class=c1># Execute RLS policy SQL</span>
</span><span id=__span-14-16><a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a>        <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>supabase</span><span class=o>.</span><span class=n>rpc</span><span class=p>(</span><span class=s1>&#39;execute_sql&#39;</span><span class=p>,</span> <span class=p>{</span>
</span><span id=__span-14-17><a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a>            <span class=s1>&#39;sql&#39;</span><span class=p>:</span> <span class=n>rls_sql</span>
</span><span id=__span-14-18><a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a>        <span class=p>})</span>
</span><span id=__span-14-19><a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a>
</span><span id=__span-14-20><a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a>        <span class=k>if</span> <span class=n>result</span><span class=o>.</span><span class=n>error</span><span class=p>:</span>
</span><span id=__span-14-21><a id=__codelineno-14-21 name=__codelineno-14-21 href=#__codelineno-14-21></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;RLS policy application failed: </span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>error</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-14-22><a id=__codelineno-14-22 name=__codelineno-14-22 href=#__codelineno-14-22></a>            <span class=k>return</span> <span class=kc>False</span>
</span><span id=__span-14-23><a id=__codelineno-14-23 name=__codelineno-14-23 href=#__codelineno-14-23></a>
</span><span id=__span-14-24><a id=__codelineno-14-24 name=__codelineno-14-24 href=#__codelineno-14-24></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;RLS policies applied successfully!&quot;</span><span class=p>)</span>
</span><span id=__span-14-25><a id=__codelineno-14-25 name=__codelineno-14-25 href=#__codelineno-14-25></a>
</span><span id=__span-14-26><a id=__codelineno-14-26 name=__codelineno-14-26 href=#__codelineno-14-26></a>        <span class=c1># Validate policies</span>
</span><span id=__span-14-27><a id=__codelineno-14-27 name=__codelineno-14-27 href=#__codelineno-14-27></a>        <span class=n>validation</span> <span class=o>=</span> <span class=n>rls_tool</span><span class=o>.</span><span class=n>validate_policies</span><span class=p>(</span><span class=n>plan</span><span class=o>.</span><span class=n>rls_policies</span><span class=p>,</span> <span class=n>analysis</span><span class=p>[</span><span class=s1>&#39;schema&#39;</span><span class=p>])</span>
</span><span id=__span-14-28><a id=__codelineno-14-28 name=__codelineno-14-28 href=#__codelineno-14-28></a>
</span><span id=__span-14-29><a id=__codelineno-14-29 name=__codelineno-14-29 href=#__codelineno-14-29></a>        <span class=n>failed_validations</span> <span class=o>=</span> <span class=p>[</span><span class=n>v</span> <span class=k>for</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>validation</span> <span class=k>if</span> <span class=ow>not</span> <span class=n>v</span><span class=p>[</span><span class=s1>&#39;valid&#39;</span><span class=p>]]</span>
</span><span id=__span-14-30><a id=__codelineno-14-30 name=__codelineno-14-30 href=#__codelineno-14-30></a>        <span class=k>if</span> <span class=n>failed_validations</span><span class=p>:</span>
</span><span id=__span-14-31><a id=__codelineno-14-31 name=__codelineno-14-31 href=#__codelineno-14-31></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Policy validation warnings:&quot;</span><span class=p>)</span>
</span><span id=__span-14-32><a id=__codelineno-14-32 name=__codelineno-14-32 href=#__codelineno-14-32></a>            <span class=k>for</span> <span class=n>validation</span> <span class=ow>in</span> <span class=n>failed_validations</span><span class=p>:</span>
</span><span id=__span-14-33><a id=__codelineno-14-33 name=__codelineno-14-33 href=#__codelineno-14-33></a>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;- </span><span class=si>{</span><span class=n>validation</span><span class=p>[</span><span class=s1>&#39;policy&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>validation</span><span class=p>[</span><span class=s1>&#39;issues&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-14-34><a id=__codelineno-14-34 name=__codelineno-14-34 href=#__codelineno-14-34></a>
</span><span id=__span-14-35><a id=__codelineno-14-35 name=__codelineno-14-35 href=#__codelineno-14-35></a>        <span class=k>return</span> <span class=kc>True</span>
</span><span id=__span-14-36><a id=__codelineno-14-36 name=__codelineno-14-36 href=#__codelineno-14-36></a>
</span><span id=__span-14-37><a id=__codelineno-14-37 name=__codelineno-14-37 href=#__codelineno-14-37></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-14-38><a id=__codelineno-14-38 name=__codelineno-14-38 href=#__codelineno-14-38></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;RLS policy application error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-14-39><a id=__codelineno-14-39 name=__codelineno-14-39 href=#__codelineno-14-39></a>        <span class=k>return</span> <span class=kc>False</span>
</span><span id=__span-14-40><a id=__codelineno-14-40 name=__codelineno-14-40 href=#__codelineno-14-40></a>
</span><span id=__span-14-41><a id=__codelineno-14-41 name=__codelineno-14-41 href=#__codelineno-14-41></a><span class=c1># Apply RLS policies</span>
</span><span id=__span-14-42><a id=__codelineno-14-42 name=__codelineno-14-42 href=#__codelineno-14-42></a><span class=n>rls_success</span> <span class=o>=</span> <span class=k>await</span> <span class=n>apply_rls_policies</span><span class=p>(</span><span class=n>plan</span><span class=p>)</span>
</span></code></pre></div> <h3 id=phase-5-data-migration>Phase 5: Data Migration<a class=headerlink href=#phase-5-data-migration title="Permanent link">&para;</a></h3> <h4 id=step-9-execute-data-migration>Step 9: Execute Data Migration<a class=headerlink href=#step-9-execute-data-migration title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>migrate_data</span><span class=p>(</span><span class=n>plan</span><span class=p>):</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>    <span class=n>agent</span> <span class=o>=</span> <span class=n>SupabaseMigrationAgent</span><span class=p>()</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Starting data migration...&quot;</span><span class=p>)</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>    <span class=c1># Execute data migration with progress tracking</span>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a>    <span class=n>progress_callback</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>progress</span><span class=p>:</span> <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Migration progress: </span><span class=si>{</span><span class=n>progress</span><span class=p>[</span><span class=s1>&#39;percentage&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>% (</span><span class=si>{</span><span class=n>progress</span><span class=p>[</span><span class=s1>&#39;table&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>)&quot;</span><span class=p>)</span>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a>
</span><span id=__span-15-9><a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a>    <span class=n>data_results</span> <span class=o>=</span> <span class=k>await</span> <span class=n>agent</span><span class=o>.</span><span class=n>execute_data_migration</span><span class=p>(</span>
</span><span id=__span-15-10><a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a>        <span class=n>plan</span><span class=o>=</span><span class=n>plan</span><span class=p>,</span>
</span><span id=__span-15-11><a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a>        <span class=n>dry_run</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span><span id=__span-15-12><a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a>        <span class=n>progress_callback</span><span class=o>=</span><span class=n>progress_callback</span>
</span><span id=__span-15-13><a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a>    <span class=p>)</span>
</span><span id=__span-15-14><a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a>
</span><span id=__span-15-15><a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a>    <span class=k>if</span> <span class=n>data_results</span><span class=p>[</span><span class=s1>&#39;status&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;completed&#39;</span><span class=p>:</span>
</span><span id=__span-15-16><a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Data migration completed successfully!&quot;</span><span class=p>)</span>
</span><span id=__span-15-17><a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a>
</span><span id=__span-15-18><a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a>        <span class=c1># Verify data integrity</span>
</span><span id=__span-15-19><a id=__codelineno-15-19 name=__codelineno-15-19 href=#__codelineno-15-19></a>        <span class=n>integrity_check</span> <span class=o>=</span> <span class=k>await</span> <span class=n>agent</span><span class=o>.</span><span class=n>verify_data_integrity</span><span class=p>(</span>
</span><span id=__span-15-20><a id=__codelineno-15-20 name=__codelineno-15-20 href=#__codelineno-15-20></a>            <span class=n>source_connection</span><span class=o>=</span><span class=n>SOURCE_DATABASE_URL</span><span class=p>,</span>
</span><span id=__span-15-21><a id=__codelineno-15-21 name=__codelineno-15-21 href=#__codelineno-15-21></a>            <span class=n>target_connection</span><span class=o>=</span><span class=n>SUPABASE_CONNECTION_STRING</span><span class=p>,</span>
</span><span id=__span-15-22><a id=__codelineno-15-22 name=__codelineno-15-22 href=#__codelineno-15-22></a>            <span class=n>tables</span><span class=o>=</span><span class=nb>list</span><span class=p>(</span><span class=n>plan</span><span class=o>.</span><span class=n>schema_mappings</span><span class=o>.</span><span class=n>keys</span><span class=p>())</span>
</span><span id=__span-15-23><a id=__codelineno-15-23 name=__codelineno-15-23 href=#__codelineno-15-23></a>        <span class=p>)</span>
</span><span id=__span-15-24><a id=__codelineno-15-24 name=__codelineno-15-24 href=#__codelineno-15-24></a>
</span><span id=__span-15-25><a id=__codelineno-15-25 name=__codelineno-15-25 href=#__codelineno-15-25></a>        <span class=k>if</span> <span class=n>integrity_check</span><span class=p>[</span><span class=s1>&#39;passed&#39;</span><span class=p>]:</span>
</span><span id=__span-15-26><a id=__codelineno-15-26 name=__codelineno-15-26 href=#__codelineno-15-26></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Data integrity verification passed!&quot;</span><span class=p>)</span>
</span><span id=__span-15-27><a id=__codelineno-15-27 name=__codelineno-15-27 href=#__codelineno-15-27></a>            <span class=k>return</span> <span class=kc>True</span>
</span><span id=__span-15-28><a id=__codelineno-15-28 name=__codelineno-15-28 href=#__codelineno-15-28></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-15-29><a id=__codelineno-15-29 name=__codelineno-15-29 href=#__codelineno-15-29></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Data integrity verification failed!&quot;</span><span class=p>)</span>
</span><span id=__span-15-30><a id=__codelineno-15-30 name=__codelineno-15-30 href=#__codelineno-15-30></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Issues found: </span><span class=si>{</span><span class=n>integrity_check</span><span class=p>[</span><span class=s1>&#39;issues&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-15-31><a id=__codelineno-15-31 name=__codelineno-15-31 href=#__codelineno-15-31></a>            <span class=k>return</span> <span class=kc>False</span>
</span><span id=__span-15-32><a id=__codelineno-15-32 name=__codelineno-15-32 href=#__codelineno-15-32></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-15-33><a id=__codelineno-15-33 name=__codelineno-15-33 href=#__codelineno-15-33></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Data migration failed: </span><span class=si>{</span><span class=n>data_results</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-15-34><a id=__codelineno-15-34 name=__codelineno-15-34 href=#__codelineno-15-34></a>
</span><span id=__span-15-35><a id=__codelineno-15-35 name=__codelineno-15-35 href=#__codelineno-15-35></a>        <span class=c1># Check for partial completion</span>
</span><span id=__span-15-36><a id=__codelineno-15-36 name=__codelineno-15-36 href=#__codelineno-15-36></a>        <span class=k>if</span> <span class=n>data_results</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;partial_completion&#39;</span><span class=p>):</span>
</span><span id=__span-15-37><a id=__codelineno-15-37 name=__codelineno-15-37 href=#__codelineno-15-37></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Partial migration completed. Resuming from checkpoint...&quot;</span><span class=p>)</span>
</span><span id=__span-15-38><a id=__codelineno-15-38 name=__codelineno-15-38 href=#__codelineno-15-38></a>            <span class=c1># Implement resume logic here</span>
</span><span id=__span-15-39><a id=__codelineno-15-39 name=__codelineno-15-39 href=#__codelineno-15-39></a>
</span><span id=__span-15-40><a id=__codelineno-15-40 name=__codelineno-15-40 href=#__codelineno-15-40></a>        <span class=k>return</span> <span class=kc>False</span>
</span><span id=__span-15-41><a id=__codelineno-15-41 name=__codelineno-15-41 href=#__codelineno-15-41></a>
</span><span id=__span-15-42><a id=__codelineno-15-42 name=__codelineno-15-42 href=#__codelineno-15-42></a><span class=c1># Execute data migration</span>
</span><span id=__span-15-43><a id=__codelineno-15-43 name=__codelineno-15-43 href=#__codelineno-15-43></a><span class=n>data_success</span> <span class=o>=</span> <span class=k>await</span> <span class=n>migrate_data</span><span class=p>(</span><span class=n>plan</span><span class=p>)</span>
</span></code></pre></div> <h3 id=phase-6-function-and-feature-migration>Phase 6: Function and Feature Migration<a class=headerlink href=#phase-6-function-and-feature-migration title="Permanent link">&para;</a></h3> <h4 id=step-10-convert-edge-functions>Step 10: Convert Edge Functions<a class=headerlink href=#step-10-convert-edge-functions title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>migrate_edge_functions</span><span class=p>(</span><span class=n>plan</span><span class=p>):</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Converting and deploying Edge Functions...&quot;</span><span class=p>)</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>    <span class=c1># Deploy each Edge Function</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a>    <span class=k>for</span> <span class=n>function_def</span> <span class=ow>in</span> <span class=n>plan</span><span class=o>.</span><span class=n>edge_functions</span><span class=p>:</span>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a>            <span class=c1># Deploy function to Supabase</span>
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a>            <span class=n>deployment_result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>deploy_edge_function</span><span class=p>(</span>
</span><span id=__span-16-9><a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a>                <span class=n>function_name</span><span class=o>=</span><span class=n>function_def</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>],</span>
</span><span id=__span-16-10><a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a>                <span class=n>function_code</span><span class=o>=</span><span class=n>function_def</span><span class=p>[</span><span class=s1>&#39;code&#39;</span><span class=p>],</span>
</span><span id=__span-16-11><a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a>                <span class=n>function_config</span><span class=o>=</span><span class=n>function_def</span><span class=p>[</span><span class=s1>&#39;config&#39;</span><span class=p>]</span>
</span><span id=__span-16-12><a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a>            <span class=p>)</span>
</span><span id=__span-16-13><a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a>
</span><span id=__span-16-14><a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a>            <span class=k>if</span> <span class=n>deployment_result</span><span class=p>[</span><span class=s1>&#39;success&#39;</span><span class=p>]:</span>
</span><span id=__span-16-15><a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✓ Deployed function: </span><span class=si>{</span><span class=n>function_def</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-16-16><a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a>
</span><span id=__span-16-17><a id=__codelineno-16-17 name=__codelineno-16-17 href=#__codelineno-16-17></a>                <span class=c1># Test function</span>
</span><span id=__span-16-18><a id=__codelineno-16-18 name=__codelineno-16-18 href=#__codelineno-16-18></a>                <span class=n>test_result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>test_edge_function</span><span class=p>(</span>
</span><span id=__span-16-19><a id=__codelineno-16-19 name=__codelineno-16-19 href=#__codelineno-16-19></a>                    <span class=n>function_name</span><span class=o>=</span><span class=n>function_def</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>],</span>
</span><span id=__span-16-20><a id=__codelineno-16-20 name=__codelineno-16-20 href=#__codelineno-16-20></a>                    <span class=n>test_cases</span><span class=o>=</span><span class=n>function_def</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;test_cases&#39;</span><span class=p>,</span> <span class=p>[])</span>
</span><span id=__span-16-21><a id=__codelineno-16-21 name=__codelineno-16-21 href=#__codelineno-16-21></a>                <span class=p>)</span>
</span><span id=__span-16-22><a id=__codelineno-16-22 name=__codelineno-16-22 href=#__codelineno-16-22></a>
</span><span id=__span-16-23><a id=__codelineno-16-23 name=__codelineno-16-23 href=#__codelineno-16-23></a>                <span class=k>if</span> <span class=n>test_result</span><span class=p>[</span><span class=s1>&#39;passed&#39;</span><span class=p>]:</span>
</span><span id=__span-16-24><a id=__codelineno-16-24 name=__codelineno-16-24 href=#__codelineno-16-24></a>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✓ Function tests passed: </span><span class=si>{</span><span class=n>function_def</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-16-25><a id=__codelineno-16-25 name=__codelineno-16-25 href=#__codelineno-16-25></a>                <span class=k>else</span><span class=p>:</span>
</span><span id=__span-16-26><a id=__codelineno-16-26 name=__codelineno-16-26 href=#__codelineno-16-26></a>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;⚠ Function tests failed: </span><span class=si>{</span><span class=n>function_def</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-16-27><a id=__codelineno-16-27 name=__codelineno-16-27 href=#__codelineno-16-27></a>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  Failures: </span><span class=si>{</span><span class=n>test_result</span><span class=p>[</span><span class=s1>&#39;failures&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-16-28><a id=__codelineno-16-28 name=__codelineno-16-28 href=#__codelineno-16-28></a>            <span class=k>else</span><span class=p>:</span>
</span><span id=__span-16-29><a id=__codelineno-16-29 name=__codelineno-16-29 href=#__codelineno-16-29></a>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✗ Failed to deploy function: </span><span class=si>{</span><span class=n>function_def</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-16-30><a id=__codelineno-16-30 name=__codelineno-16-30 href=#__codelineno-16-30></a>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  Error: </span><span class=si>{</span><span class=n>deployment_result</span><span class=p>[</span><span class=s1>&#39;error&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-16-31><a id=__codelineno-16-31 name=__codelineno-16-31 href=#__codelineno-16-31></a>
</span><span id=__span-16-32><a id=__codelineno-16-32 name=__codelineno-16-32 href=#__codelineno-16-32></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-16-33><a id=__codelineno-16-33 name=__codelineno-16-33 href=#__codelineno-16-33></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error deploying function </span><span class=si>{</span><span class=n>function_def</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-16-34><a id=__codelineno-16-34 name=__codelineno-16-34 href=#__codelineno-16-34></a>
</span><span id=__span-16-35><a id=__codelineno-16-35 name=__codelineno-16-35 href=#__codelineno-16-35></a><span class=c1># Convert and deploy Edge Functions</span>
</span><span id=__span-16-36><a id=__codelineno-16-36 name=__codelineno-16-36 href=#__codelineno-16-36></a><span class=k>await</span> <span class=n>migrate_edge_functions</span><span class=p>(</span><span class=n>plan</span><span class=p>)</span>
</span></code></pre></div> <h4 id=step-11-migrate-storage>Step 11: Migrate Storage<a class=headerlink href=#step-11-migrate-storage title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>migrate_storage</span><span class=p>(</span><span class=n>plan</span><span class=p>):</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Migrating file storage...&quot;</span><span class=p>)</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a>    <span class=c1># Create storage buckets</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a>    <span class=k>for</span> <span class=n>bucket_def</span> <span class=ow>in</span> <span class=n>plan</span><span class=o>.</span><span class=n>storage_buckets</span><span class=p>:</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a>            <span class=c1># Create bucket in Supabase Storage</span>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a>            <span class=n>bucket_result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>create_storage_bucket</span><span class=p>(</span>
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a>                <span class=n>bucket_name</span><span class=o>=</span><span class=n>bucket_def</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>],</span>
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a>                <span class=n>bucket_config</span><span class=o>=</span><span class=n>bucket_def</span><span class=p>[</span><span class=s1>&#39;config&#39;</span><span class=p>]</span>
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a>            <span class=p>)</span>
</span><span id=__span-17-12><a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a>
</span><span id=__span-17-13><a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a>            <span class=k>if</span> <span class=n>bucket_result</span><span class=p>[</span><span class=s1>&#39;success&#39;</span><span class=p>]:</span>
</span><span id=__span-17-14><a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✓ Created bucket: </span><span class=si>{</span><span class=n>bucket_def</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-17-15><a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a>
</span><span id=__span-17-16><a id=__codelineno-17-16 name=__codelineno-17-16 href=#__codelineno-17-16></a>                <span class=c1># Migrate files</span>
</span><span id=__span-17-17><a id=__codelineno-17-17 name=__codelineno-17-17 href=#__codelineno-17-17></a>                <span class=k>if</span> <span class=n>bucket_def</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;files&#39;</span><span class=p>):</span>
</span><span id=__span-17-18><a id=__codelineno-17-18 name=__codelineno-17-18 href=#__codelineno-17-18></a>                    <span class=n>migration_result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>migrate_bucket_files</span><span class=p>(</span>
</span><span id=__span-17-19><a id=__codelineno-17-19 name=__codelineno-17-19 href=#__codelineno-17-19></a>                        <span class=n>source_path</span><span class=o>=</span><span class=n>bucket_def</span><span class=p>[</span><span class=s1>&#39;source_path&#39;</span><span class=p>],</span>
</span><span id=__span-17-20><a id=__codelineno-17-20 name=__codelineno-17-20 href=#__codelineno-17-20></a>                        <span class=n>target_bucket</span><span class=o>=</span><span class=n>bucket_def</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>],</span>
</span><span id=__span-17-21><a id=__codelineno-17-21 name=__codelineno-17-21 href=#__codelineno-17-21></a>                        <span class=n>file_list</span><span class=o>=</span><span class=n>bucket_def</span><span class=p>[</span><span class=s1>&#39;files&#39;</span><span class=p>]</span>
</span><span id=__span-17-22><a id=__codelineno-17-22 name=__codelineno-17-22 href=#__codelineno-17-22></a>                    <span class=p>)</span>
</span><span id=__span-17-23><a id=__codelineno-17-23 name=__codelineno-17-23 href=#__codelineno-17-23></a>
</span><span id=__span-17-24><a id=__codelineno-17-24 name=__codelineno-17-24 href=#__codelineno-17-24></a>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✓ Migrated </span><span class=si>{</span><span class=n>migration_result</span><span class=p>[</span><span class=s1>&#39;files_migrated&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> files&quot;</span><span class=p>)</span>
</span><span id=__span-17-25><a id=__codelineno-17-25 name=__codelineno-17-25 href=#__codelineno-17-25></a>            <span class=k>else</span><span class=p>:</span>
</span><span id=__span-17-26><a id=__codelineno-17-26 name=__codelineno-17-26 href=#__codelineno-17-26></a>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;✗ Failed to create bucket: </span><span class=si>{</span><span class=n>bucket_def</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-17-27><a id=__codelineno-17-27 name=__codelineno-17-27 href=#__codelineno-17-27></a>
</span><span id=__span-17-28><a id=__codelineno-17-28 name=__codelineno-17-28 href=#__codelineno-17-28></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-17-29><a id=__codelineno-17-29 name=__codelineno-17-29 href=#__codelineno-17-29></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error migrating bucket </span><span class=si>{</span><span class=n>bucket_def</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-17-30><a id=__codelineno-17-30 name=__codelineno-17-30 href=#__codelineno-17-30></a>
</span><span id=__span-17-31><a id=__codelineno-17-31 name=__codelineno-17-31 href=#__codelineno-17-31></a><span class=c1># Migrate storage</span>
</span><span id=__span-17-32><a id=__codelineno-17-32 name=__codelineno-17-32 href=#__codelineno-17-32></a><span class=k>await</span> <span class=n>migrate_storage</span><span class=p>(</span><span class=n>plan</span><span class=p>)</span>
</span></code></pre></div> <h3 id=phase-7-validation-and-testing>Phase 7: Validation and Testing<a class=headerlink href=#phase-7-validation-and-testing title="Permanent link">&para;</a></h3> <h4 id=step-12-comprehensive-validation>Step 12: Comprehensive Validation<a class=headerlink href=#step-12-comprehensive-validation title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>comprehensive_validation</span><span class=p>():</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>    <span class=n>agent</span> <span class=o>=</span> <span class=n>SupabaseMigrationAgent</span><span class=p>()</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Performing comprehensive validation...&quot;</span><span class=p>)</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a>    <span class=c1># Full migration validation</span>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a>    <span class=n>validation</span> <span class=o>=</span> <span class=k>await</span> <span class=n>agent</span><span class=o>.</span><span class=n>validate_migration</span><span class=p>(</span>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a>        <span class=n>source_connection</span><span class=o>=</span><span class=n>SOURCE_DATABASE_URL</span><span class=p>,</span>
</span><span id=__span-18-9><a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a>        <span class=n>target_connection</span><span class=o>=</span><span class=n>SUPABASE_CONNECTION_STRING</span>
</span><span id=__span-18-10><a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a>    <span class=p>)</span>
</span><span id=__span-18-11><a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a>
</span><span id=__span-18-12><a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a>    <span class=c1># Print validation results</span>
</span><span id=__span-18-13><a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Overall Status: </span><span class=si>{</span><span class=n>validation</span><span class=p>[</span><span class=s1>&#39;overall_status&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-18-14><a id=__codelineno-18-14 name=__codelineno-18-14 href=#__codelineno-18-14></a>
</span><span id=__span-18-15><a id=__codelineno-18-15 name=__codelineno-18-15 href=#__codelineno-18-15></a>    <span class=k>for</span> <span class=n>check_name</span><span class=p>,</span> <span class=n>check_result</span> <span class=ow>in</span> <span class=n>validation</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-18-16><a id=__codelineno-18-16 name=__codelineno-18-16 href=#__codelineno-18-16></a>        <span class=k>if</span> <span class=n>check_name</span> <span class=o>!=</span> <span class=s1>&#39;overall_status&#39;</span><span class=p>:</span>
</span><span id=__span-18-17><a id=__codelineno-18-17 name=__codelineno-18-17 href=#__codelineno-18-17></a>            <span class=n>status</span> <span class=o>=</span> <span class=s2>&quot;✓&quot;</span> <span class=k>if</span> <span class=n>check_result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;status&#39;</span><span class=p>)</span> <span class=o>==</span> <span class=s1>&#39;passed&#39;</span> <span class=k>else</span> <span class=s2>&quot;✗&quot;</span>
</span><span id=__span-18-18><a id=__codelineno-18-18 name=__codelineno-18-18 href=#__codelineno-18-18></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>status</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>check_name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>check_result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;status&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-18-19><a id=__codelineno-18-19 name=__codelineno-18-19 href=#__codelineno-18-19></a>
</span><span id=__span-18-20><a id=__codelineno-18-20 name=__codelineno-18-20 href=#__codelineno-18-20></a>            <span class=k>if</span> <span class=n>check_result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;status&#39;</span><span class=p>)</span> <span class=o>==</span> <span class=s1>&#39;failed&#39;</span><span class=p>:</span>
</span><span id=__span-18-21><a id=__codelineno-18-21 name=__codelineno-18-21 href=#__codelineno-18-21></a>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;   Issues: </span><span class=si>{</span><span class=n>check_result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;issues&#39;</span><span class=p>,</span><span class=w> </span><span class=p>[])</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-18-22><a id=__codelineno-18-22 name=__codelineno-18-22 href=#__codelineno-18-22></a>
</span><span id=__span-18-23><a id=__codelineno-18-23 name=__codelineno-18-23 href=#__codelineno-18-23></a>    <span class=k>return</span> <span class=n>validation</span><span class=p>[</span><span class=s1>&#39;overall_status&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;passed&#39;</span>
</span><span id=__span-18-24><a id=__codelineno-18-24 name=__codelineno-18-24 href=#__codelineno-18-24></a>
</span><span id=__span-18-25><a id=__codelineno-18-25 name=__codelineno-18-25 href=#__codelineno-18-25></a><span class=c1># Perform validation</span>
</span><span id=__span-18-26><a id=__codelineno-18-26 name=__codelineno-18-26 href=#__codelineno-18-26></a><span class=n>validation_passed</span> <span class=o>=</span> <span class=k>await</span> <span class=n>comprehensive_validation</span><span class=p>()</span>
</span><span id=__span-18-27><a id=__codelineno-18-27 name=__codelineno-18-27 href=#__codelineno-18-27></a>
</span><span id=__span-18-28><a id=__codelineno-18-28 name=__codelineno-18-28 href=#__codelineno-18-28></a><span class=k>if</span> <span class=ow>not</span> <span class=n>validation_passed</span><span class=p>:</span>
</span><span id=__span-18-29><a id=__codelineno-18-29 name=__codelineno-18-29 href=#__codelineno-18-29></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Migration validation failed. Please review and fix issues.&quot;</span><span class=p>)</span>
</span><span id=__span-18-30><a id=__codelineno-18-30 name=__codelineno-18-30 href=#__codelineno-18-30></a>    <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></code></pre></div> <h4 id=step-13-performance-testing>Step 13: Performance Testing<a class=headerlink href=#step-13-performance-testing title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>performance_testing</span><span class=p>():</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Running performance tests...&quot;</span><span class=p>)</span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a>    <span class=c1># Define test queries</span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a>    <span class=n>test_queries</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a>        <span class=p>{</span>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a>            <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;User lookup by ID&quot;</span><span class=p>,</span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a>            <span class=s2>&quot;sql&quot;</span><span class=p>:</span> <span class=s2>&quot;SELECT * FROM users WHERE id = $1&quot;</span><span class=p>,</span>
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a>            <span class=s2>&quot;params&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;test-user-id&quot;</span><span class=p>]</span>
</span><span id=__span-19-10><a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a>        <span class=p>},</span>
</span><span id=__span-19-11><a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a>        <span class=p>{</span>
</span><span id=__span-19-12><a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a>            <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;Recent lessons query&quot;</span><span class=p>,</span>
</span><span id=__span-19-13><a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a>            <span class=s2>&quot;sql&quot;</span><span class=p>:</span> <span class=s2>&quot;SELECT * FROM lessons WHERE created_at &gt; NOW() - INTERVAL &#39;7 days&#39;&quot;</span><span class=p>,</span>
</span><span id=__span-19-14><a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a>            <span class=s2>&quot;params&quot;</span><span class=p>:</span> <span class=p>[]</span>
</span><span id=__span-19-15><a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a>        <span class=p>},</span>
</span><span id=__span-19-16><a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a>        <span class=p>{</span>
</span><span id=__span-19-17><a id=__codelineno-19-17 name=__codelineno-19-17 href=#__codelineno-19-17></a>            <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;Complex join query&quot;</span><span class=p>,</span>
</span><span id=__span-19-18><a id=__codelineno-19-18 name=__codelineno-19-18 href=#__codelineno-19-18></a>            <span class=s2>&quot;sql&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;&quot;</span>
</span><span id=__span-19-19><a id=__codelineno-19-19 name=__codelineno-19-19 href=#__codelineno-19-19></a><span class=s2>                SELECT u.name, l.title, e.enrolled_at</span>
</span><span id=__span-19-20><a id=__codelineno-19-20 name=__codelineno-19-20 href=#__codelineno-19-20></a><span class=s2>                FROM users u</span>
</span><span id=__span-19-21><a id=__codelineno-19-21 name=__codelineno-19-21 href=#__codelineno-19-21></a><span class=s2>                JOIN enrollments e ON u.id = e.student_id</span>
</span><span id=__span-19-22><a id=__codelineno-19-22 name=__codelineno-19-22 href=#__codelineno-19-22></a><span class=s2>                JOIN lessons l ON e.lesson_id = l.id</span>
</span><span id=__span-19-23><a id=__codelineno-19-23 name=__codelineno-19-23 href=#__codelineno-19-23></a><span class=s2>                WHERE u.organization_id = $1</span>
</span><span id=__span-19-24><a id=__codelineno-19-24 name=__codelineno-19-24 href=#__codelineno-19-24></a><span class=s2>            &quot;&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-19-25><a id=__codelineno-19-25 name=__codelineno-19-25 href=#__codelineno-19-25></a>            <span class=s2>&quot;params&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;test-org-id&quot;</span><span class=p>]</span>
</span><span id=__span-19-26><a id=__codelineno-19-26 name=__codelineno-19-26 href=#__codelineno-19-26></a>        <span class=p>}</span>
</span><span id=__span-19-27><a id=__codelineno-19-27 name=__codelineno-19-27 href=#__codelineno-19-27></a>    <span class=p>]</span>
</span><span id=__span-19-28><a id=__codelineno-19-28 name=__codelineno-19-28 href=#__codelineno-19-28></a>
</span><span id=__span-19-29><a id=__codelineno-19-29 name=__codelineno-19-29 href=#__codelineno-19-29></a>    <span class=c1># Run performance comparison</span>
</span><span id=__span-19-30><a id=__codelineno-19-30 name=__codelineno-19-30 href=#__codelineno-19-30></a>    <span class=n>performance_results</span> <span class=o>=</span> <span class=k>await</span> <span class=n>compare_query_performance</span><span class=p>(</span>
</span><span id=__span-19-31><a id=__codelineno-19-31 name=__codelineno-19-31 href=#__codelineno-19-31></a>        <span class=n>source_connection</span><span class=o>=</span><span class=n>SOURCE_DATABASE_URL</span><span class=p>,</span>
</span><span id=__span-19-32><a id=__codelineno-19-32 name=__codelineno-19-32 href=#__codelineno-19-32></a>        <span class=n>target_connection</span><span class=o>=</span><span class=n>SUPABASE_CONNECTION_STRING</span><span class=p>,</span>
</span><span id=__span-19-33><a id=__codelineno-19-33 name=__codelineno-19-33 href=#__codelineno-19-33></a>        <span class=n>test_queries</span><span class=o>=</span><span class=n>test_queries</span><span class=p>,</span>
</span><span id=__span-19-34><a id=__codelineno-19-34 name=__codelineno-19-34 href=#__codelineno-19-34></a>        <span class=n>iterations</span><span class=o>=</span><span class=mi>10</span>
</span><span id=__span-19-35><a id=__codelineno-19-35 name=__codelineno-19-35 href=#__codelineno-19-35></a>    <span class=p>)</span>
</span><span id=__span-19-36><a id=__codelineno-19-36 name=__codelineno-19-36 href=#__codelineno-19-36></a>
</span><span id=__span-19-37><a id=__codelineno-19-37 name=__codelineno-19-37 href=#__codelineno-19-37></a>    <span class=c1># Analyze results</span>
</span><span id=__span-19-38><a id=__codelineno-19-38 name=__codelineno-19-38 href=#__codelineno-19-38></a>    <span class=k>for</span> <span class=n>query_result</span> <span class=ow>in</span> <span class=n>performance_results</span><span class=p>:</span>
</span><span id=__span-19-39><a id=__codelineno-19-39 name=__codelineno-19-39 href=#__codelineno-19-39></a>        <span class=n>query_name</span> <span class=o>=</span> <span class=n>query_result</span><span class=p>[</span><span class=s1>&#39;query_name&#39;</span><span class=p>]</span>
</span><span id=__span-19-40><a id=__codelineno-19-40 name=__codelineno-19-40 href=#__codelineno-19-40></a>        <span class=n>source_avg</span> <span class=o>=</span> <span class=n>query_result</span><span class=p>[</span><span class=s1>&#39;source_avg_ms&#39;</span><span class=p>]</span>
</span><span id=__span-19-41><a id=__codelineno-19-41 name=__codelineno-19-41 href=#__codelineno-19-41></a>        <span class=n>target_avg</span> <span class=o>=</span> <span class=n>query_result</span><span class=p>[</span><span class=s1>&#39;target_avg_ms&#39;</span><span class=p>]</span>
</span><span id=__span-19-42><a id=__codelineno-19-42 name=__codelineno-19-42 href=#__codelineno-19-42></a>        <span class=n>improvement</span> <span class=o>=</span> <span class=p>((</span><span class=n>source_avg</span> <span class=o>-</span> <span class=n>target_avg</span><span class=p>)</span> <span class=o>/</span> <span class=n>source_avg</span><span class=p>)</span> <span class=o>*</span> <span class=mi>100</span>
</span><span id=__span-19-43><a id=__codelineno-19-43 name=__codelineno-19-43 href=#__codelineno-19-43></a>
</span><span id=__span-19-44><a id=__codelineno-19-44 name=__codelineno-19-44 href=#__codelineno-19-44></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Query: </span><span class=si>{</span><span class=n>query_name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-19-45><a id=__codelineno-19-45 name=__codelineno-19-45 href=#__codelineno-19-45></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  Source: </span><span class=si>{</span><span class=n>source_avg</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>ms&quot;</span><span class=p>)</span>
</span><span id=__span-19-46><a id=__codelineno-19-46 name=__codelineno-19-46 href=#__codelineno-19-46></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  Target: </span><span class=si>{</span><span class=n>target_avg</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>ms&quot;</span><span class=p>)</span>
</span><span id=__span-19-47><a id=__codelineno-19-47 name=__codelineno-19-47 href=#__codelineno-19-47></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  Change: </span><span class=si>{</span><span class=n>improvement</span><span class=si>:</span><span class=s2>+.1f</span><span class=si>}</span><span class=s2>%&quot;</span><span class=p>)</span>
</span><span id=__span-19-48><a id=__codelineno-19-48 name=__codelineno-19-48 href=#__codelineno-19-48></a>
</span><span id=__span-19-49><a id=__codelineno-19-49 name=__codelineno-19-49 href=#__codelineno-19-49></a><span class=c1># Run performance tests</span>
</span><span id=__span-19-50><a id=__codelineno-19-50 name=__codelineno-19-50 href=#__codelineno-19-50></a><span class=k>await</span> <span class=n>performance_testing</span><span class=p>()</span>
</span></code></pre></div> <h2 id=common-migration-scenarios>Common Migration Scenarios<a class=headerlink href=#common-migration-scenarios title="Permanent link">&para;</a></h2> <h3 id=scenario-1-educational-platform-toolboxai>Scenario 1: Educational Platform (ToolBoxAI)<a class=headerlink href=#scenario-1-educational-platform-toolboxai title="Permanent link">&para;</a></h3> <h4 id=characteristics>Characteristics<a class=headerlink href=#characteristics title="Permanent link">&para;</a></h4> <ul> <li>40+ tables with complex relationships</li> <li>User management with role-based access</li> <li>Content with vector embeddings</li> <li>Real-time features for collaboration</li> <li>Multi-tenant architecture</li> </ul> <h4 id=migration-approach>Migration Approach<a class=headerlink href=#migration-approach title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=c1># Educational platform specific configuration</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=n>education_migration_options</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a>    <span class=s2>&quot;enable_realtime&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>          <span class=c1># For collaborative features</span>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a>    <span class=s2>&quot;vector_dimensions&quot;</span><span class=p>:</span> <span class=mi>1536</span><span class=p>,</span>        <span class=c1># OpenAI embeddings</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a>    <span class=s2>&quot;multi_tenant&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>             <span class=c1># Organization isolation</span>
</span><span id=__span-20-6><a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a>    <span class=s2>&quot;rls_strategy&quot;</span><span class=p>:</span> <span class=s2>&quot;hierarchical&quot;</span><span class=p>,</span>   <span class=c1># Role-based access</span>
</span><span id=__span-20-7><a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a>    <span class=s2>&quot;preserve_user_sessions&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>   <span class=c1># Maintain active sessions</span>
</span><span id=__span-20-8><a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a>    <span class=s2>&quot;batch_size&quot;</span><span class=p>:</span> <span class=mi>500</span><span class=p>,</span>               <span class=c1># Conservative for data integrity</span>
</span><span id=__span-20-9><a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a>    <span class=s2>&quot;enable_audit_logging&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>     <span class=c1># Compliance requirements</span>
</span><span id=__span-20-10><a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a>    <span class=s2>&quot;custom_types&quot;</span><span class=p>:</span> <span class=p>[</span>                 <span class=c1># Platform-specific types</span>
</span><span id=__span-20-11><a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a>        <span class=s2>&quot;lesson_status&quot;</span><span class=p>,</span>
</span><span id=__span-20-12><a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a>        <span class=s2>&quot;quiz_type&quot;</span><span class=p>,</span>
</span><span id=__span-20-13><a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a>        <span class=s2>&quot;progress_state&quot;</span>
</span><span id=__span-20-14><a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a>    <span class=p>]</span>
</span><span id=__span-20-15><a id=__codelineno-20-15 name=__codelineno-20-15 href=#__codelineno-20-15></a><span class=p>}</span>
</span><span id=__span-20-16><a id=__codelineno-20-16 name=__codelineno-20-16 href=#__codelineno-20-16></a>
</span><span id=__span-20-17><a id=__codelineno-20-17 name=__codelineno-20-17 href=#__codelineno-20-17></a><span class=c1># Specific RLS policies for education</span>
</span><span id=__span-20-18><a id=__codelineno-20-18 name=__codelineno-20-18 href=#__codelineno-20-18></a><span class=n>custom_rls_policies</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-20-19><a id=__codelineno-20-19 name=__codelineno-20-19 href=#__codelineno-20-19></a>    <span class=p>{</span>
</span><span id=__span-20-20><a id=__codelineno-20-20 name=__codelineno-20-20 href=#__codelineno-20-20></a>        <span class=s2>&quot;table&quot;</span><span class=p>:</span> <span class=s2>&quot;lessons&quot;</span><span class=p>,</span>
</span><span id=__span-20-21><a id=__codelineno-20-21 name=__codelineno-20-21 href=#__codelineno-20-21></a>        <span class=s2>&quot;policy&quot;</span><span class=p>:</span> <span class=s2>&quot;students_enrolled_content&quot;</span><span class=p>,</span>
</span><span id=__span-20-22><a id=__codelineno-20-22 name=__codelineno-20-22 href=#__codelineno-20-22></a>        <span class=s2>&quot;sql&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;&quot;</span>
</span><span id=__span-20-23><a id=__codelineno-20-23 name=__codelineno-20-23 href=#__codelineno-20-23></a><span class=s2>            EXISTS (</span>
</span><span id=__span-20-24><a id=__codelineno-20-24 name=__codelineno-20-24 href=#__codelineno-20-24></a><span class=s2>                SELECT 1 FROM enrollments e</span>
</span><span id=__span-20-25><a id=__codelineno-20-25 name=__codelineno-20-25 href=#__codelineno-20-25></a><span class=s2>                JOIN classes c ON e.class_id = c.id</span>
</span><span id=__span-20-26><a id=__codelineno-20-26 name=__codelineno-20-26 href=#__codelineno-20-26></a><span class=s2>                JOIN class_lessons cl ON c.id = cl.class_id</span>
</span><span id=__span-20-27><a id=__codelineno-20-27 name=__codelineno-20-27 href=#__codelineno-20-27></a><span class=s2>                WHERE e.student_id = auth.uid()</span>
</span><span id=__span-20-28><a id=__codelineno-20-28 name=__codelineno-20-28 href=#__codelineno-20-28></a><span class=s2>                AND cl.lesson_id = lessons.id</span>
</span><span id=__span-20-29><a id=__codelineno-20-29 name=__codelineno-20-29 href=#__codelineno-20-29></a><span class=s2>                AND e.status = &#39;active&#39;</span>
</span><span id=__span-20-30><a id=__codelineno-20-30 name=__codelineno-20-30 href=#__codelineno-20-30></a><span class=s2>            )</span>
</span><span id=__span-20-31><a id=__codelineno-20-31 name=__codelineno-20-31 href=#__codelineno-20-31></a><span class=s2>        &quot;&quot;&quot;</span>
</span><span id=__span-20-32><a id=__codelineno-20-32 name=__codelineno-20-32 href=#__codelineno-20-32></a>    <span class=p>}</span>
</span><span id=__span-20-33><a id=__codelineno-20-33 name=__codelineno-20-33 href=#__codelineno-20-33></a><span class=p>]</span>
</span></code></pre></div> <h4 id=timeline-12-16-hours>Timeline: 12-16 hours<a class=headerlink href=#timeline-12-16-hours title="Permanent link">&para;</a></h4> <ul> <li>Analysis: 2 hours</li> <li>Planning: 2 hours</li> <li>Schema migration: 2 hours</li> <li>Data migration: 6 hours</li> <li>Function conversion: 2 hours</li> <li>Testing: 2 hours</li> </ul> <h3 id=scenario-2-e-commerce-platform>Scenario 2: E-commerce Platform<a class=headerlink href=#scenario-2-e-commerce-platform title="Permanent link">&para;</a></h3> <h4 id=characteristics_1>Characteristics<a class=headerlink href=#characteristics_1 title="Permanent link">&para;</a></h4> <ul> <li>High transaction volume</li> <li>Complex pricing and inventory logic</li> <li>Payment processing integration</li> <li>Analytics and reporting requirements</li> </ul> <h4 id=migration-approach_1>Migration Approach<a class=headerlink href=#migration-approach_1 title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=c1># E-commerce specific configuration</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=n>ecommerce_migration_options</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a>    <span class=s2>&quot;enable_realtime&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>          <span class=c1># Inventory updates</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a>    <span class=s2>&quot;preserve_transactions&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>     <span class=c1># Critical for consistency</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a>    <span class=s2>&quot;enable_row_security&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>      <span class=c1># Customer data protection</span>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a>    <span class=s2>&quot;batch_size&quot;</span><span class=p>:</span> <span class=mi>2000</span><span class=p>,</span>              <span class=c1># Higher throughput needed</span>
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a>    <span class=s2>&quot;parallel_workers&quot;</span><span class=p>:</span> <span class=mi>6</span><span class=p>,</span>           <span class=c1># Faster data migration</span>
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a>    <span class=s2>&quot;custom_functions&quot;</span><span class=p>:</span> <span class=p>[</span>            <span class=c1># Business logic preservation</span>
</span><span id=__span-21-9><a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a>        <span class=s2>&quot;calculate_shipping&quot;</span><span class=p>,</span>
</span><span id=__span-21-10><a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a>        <span class=s2>&quot;apply_discounts&quot;</span><span class=p>,</span>
</span><span id=__span-21-11><a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a>        <span class=s2>&quot;update_inventory&quot;</span>
</span><span id=__span-21-12><a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a>    <span class=p>]</span>
</span><span id=__span-21-13><a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a><span class=p>}</span>
</span></code></pre></div> <h3 id=scenario-3-saas-application>Scenario 3: SaaS Application<a class=headerlink href=#scenario-3-saas-application title="Permanent link">&para;</a></h3> <h4 id=characteristics_2>Characteristics<a class=headerlink href=#characteristics_2 title="Permanent link">&para;</a></h4> <ul> <li>Multi-tenant with strict isolation</li> <li>Feature flags and subscription tiers</li> <li>API-heavy architecture</li> <li>Real-time notifications</li> </ul> <h4 id=migration-approach_2>Migration Approach<a class=headerlink href=#migration-approach_2 title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=c1># SaaS specific configuration</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=n>saas_migration_options</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>    <span class=s2>&quot;multi_tenant&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a>    <span class=s2>&quot;tenant_isolation_strategy&quot;</span><span class=p>:</span> <span class=s2>&quot;rls&quot;</span><span class=p>,</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a>    <span class=s2>&quot;api_endpoint_conversion&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a>    <span class=s2>&quot;subscription_tier_mapping&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-22-7><a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a>    <span class=s2>&quot;feature_flag_migration&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-22-8><a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a>    <span class=s2>&quot;webhook_endpoint_migration&quot;</span><span class=p>:</span> <span class=kc>True</span>
</span><span id=__span-22-9><a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a><span class=p>}</span>
</span></code></pre></div> <h2 id=troubleshooting>Troubleshooting<a class=headerlink href=#troubleshooting title="Permanent link">&para;</a></h2> <h3 id=common-issues-and-solutions>Common Issues and Solutions<a class=headerlink href=#common-issues-and-solutions title="Permanent link">&para;</a></h3> <h4 id=issue-1-connection-timeouts>Issue 1: Connection Timeouts<a class=headerlink href=#issue-1-connection-timeouts title="Permanent link">&para;</a></h4> <p><strong>Symptoms:</strong> - Migration fails with timeout errors - Intermittent connection drops</p> <p><strong>Solutions:</strong> <div class="language-python highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=c1># Increase timeout settings</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=n>migration_options</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a>    <span class=s2>&quot;connection_timeout&quot;</span><span class=p>:</span> <span class=mi>300</span><span class=p>,</span>      <span class=c1># 5 minutes</span>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a>    <span class=s2>&quot;query_timeout&quot;</span><span class=p>:</span> <span class=mi>600</span><span class=p>,</span>          <span class=c1># 10 minutes</span>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a>    <span class=s2>&quot;retry_attempts&quot;</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a>    <span class=s2>&quot;retry_backoff&quot;</span><span class=p>:</span> <span class=mi>5</span>             <span class=c1># seconds</span>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=p>}</span>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a>
</span><span id=__span-23-9><a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=c1># Use connection pooling</span>
</span><span id=__span-23-10><a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=n>connection_config</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-23-11><a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a>    <span class=s2>&quot;pool_size&quot;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span>
</span><span id=__span-23-12><a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a>    <span class=s2>&quot;max_overflow&quot;</span><span class=p>:</span> <span class=mi>10</span><span class=p>,</span>
</span><span id=__span-23-13><a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a>    <span class=s2>&quot;pool_timeout&quot;</span><span class=p>:</span> <span class=mi>30</span><span class=p>,</span>
</span><span id=__span-23-14><a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a>    <span class=s2>&quot;pool_recycle&quot;</span><span class=p>:</span> <span class=mi>3600</span>
</span><span id=__span-23-15><a id=__codelineno-23-15 name=__codelineno-23-15 href=#__codelineno-23-15></a><span class=p>}</span>
</span></code></pre></div></p> <h4 id=issue-2-memory-issues-with-large-tables>Issue 2: Memory Issues with Large Tables<a class=headerlink href=#issue-2-memory-issues-with-large-tables title="Permanent link">&para;</a></h4> <p><strong>Symptoms:</strong> - Out of memory errors - Slow performance during data migration</p> <p><strong>Solutions:</strong> <div class="language-python highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=c1># Reduce batch size and use streaming</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=n>large_table_options</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>    <span class=s2>&quot;batch_size&quot;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span>             <span class=c1># Smaller batches</span>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a>    <span class=s2>&quot;use_streaming&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>         <span class=c1># Stream instead of loading all</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a>    <span class=s2>&quot;enable_compression&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>    <span class=c1># Compress data in transit</span>
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a>    <span class=s2>&quot;checkpoint_interval&quot;</span><span class=p>:</span> <span class=mi>1000</span>    <span class=c1># Save progress frequently</span>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=p>}</span>
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a>
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=c1># Process tables sequentially</span>
</span><span id=__span-24-10><a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a><span class=n>migration_order</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-24-11><a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a>    <span class=s2>&quot;small_tables_first&quot;</span><span class=p>,</span>
</span><span id=__span-24-12><a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a>    <span class=s2>&quot;medium_tables&quot;</span><span class=p>,</span>
</span><span id=__span-24-13><a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a>    <span class=s2>&quot;large_tables_last&quot;</span>
</span><span id=__span-24-14><a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a><span class=p>]</span>
</span></code></pre></div></p> <h4 id=issue-3-rls-policy-conflicts>Issue 3: RLS Policy Conflicts<a class=headerlink href=#issue-3-rls-policy-conflicts title="Permanent link">&para;</a></h4> <p><strong>Symptoms:</strong> - Access denied errors after migration - Users can't see expected data</p> <p><strong>Solutions:</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=c1>-- Debug RLS policies</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=k>SET</span><span class=w> </span><span class=n>row_security</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>off</span><span class=p>;</span><span class=w>  </span><span class=c1>-- Temporarily disable RLS for testing</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=c1>-- Check policy definitions</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=k>SELECT</span><span class=w> </span><span class=n>schemaname</span><span class=p>,</span><span class=w> </span><span class=n>tablename</span><span class=p>,</span><span class=w> </span><span class=n>policyname</span><span class=p>,</span><span class=w> </span><span class=n>roles</span><span class=p>,</span><span class=w> </span><span class=n>cmd</span><span class=p>,</span><span class=w> </span><span class=n>qual</span>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=k>FROM</span><span class=w> </span><span class=n>pg_policies</span>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=k>WHERE</span><span class=w> </span><span class=n>tablename</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;your_table&#39;</span><span class=p>;</span>
</span><span id=__span-25-8><a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a>
</span><span id=__span-25-9><a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a><span class=c1>-- Test policy logic</span>
</span><span id=__span-25-10><a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a><span class=k>SELECT</span><span class=w> </span><span class=n>auth</span><span class=p>.</span><span class=n>uid</span><span class=p>(),</span><span class=w> </span><span class=n>organization_id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>auth</span><span class=p>.</span><span class=n>uid</span><span class=p>();</span>
</span></code></pre></div></p> <h4 id=issue-4-data-type-conversion-issues>Issue 4: Data Type Conversion Issues<a class=headerlink href=#issue-4-data-type-conversion-issues title="Permanent link">&para;</a></h4> <p><strong>Symptoms:</strong> - Data type mismatch errors - Precision loss in numeric data</p> <p><strong>Solutions:</strong> <div class="language-python highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=c1># Custom type mappings</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=n>type_mappings</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a>    <span class=s2>&quot;serial&quot;</span><span class=p>:</span> <span class=s2>&quot;bigint&quot;</span><span class=p>,</span>           <span class=c1># Use bigint instead of serial</span>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a>    <span class=s2>&quot;money&quot;</span><span class=p>:</span> <span class=s2>&quot;decimal(19,4)&quot;</span><span class=p>,</span>     <span class=c1># Convert money to decimal</span>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a>    <span class=s2>&quot;jsonb&quot;</span><span class=p>:</span> <span class=s2>&quot;jsonb&quot;</span><span class=p>,</span>             <span class=c1># Direct mapping for JSON</span>
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a>    <span class=s2>&quot;uuid&quot;</span><span class=p>:</span> <span class=s2>&quot;uuid&quot;</span><span class=p>,</span>               <span class=c1># Direct UUID mapping</span>
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a>    <span class=s2>&quot;timestamp&quot;</span><span class=p>:</span> <span class=s2>&quot;timestamptz&quot;</span>     <span class=c1># Use timezone-aware timestamps</span>
</span><span id=__span-26-8><a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=p>}</span>
</span><span id=__span-26-9><a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a>
</span><span id=__span-26-10><a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a><span class=c1># Pre-migration data validation</span>
</span><span id=__span-26-11><a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a><span class=n>validation_rules</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-26-12><a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a>    <span class=s2>&quot;check_numeric_precision&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-26-13><a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a>    <span class=s2>&quot;validate_json_structure&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-26-14><a id=__codelineno-26-14 name=__codelineno-26-14 href=#__codelineno-26-14></a>    <span class=s2>&quot;check_uuid_format&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-26-15><a id=__codelineno-26-15 name=__codelineno-26-15 href=#__codelineno-26-15></a>    <span class=s2>&quot;validate_date_ranges&quot;</span><span class=p>:</span> <span class=kc>True</span>
</span><span id=__span-26-16><a id=__codelineno-26-16 name=__codelineno-26-16 href=#__codelineno-26-16></a><span class=p>}</span>
</span></code></pre></div></p> <h4 id=issue-5-foreign-key-constraint-violations>Issue 5: Foreign Key Constraint Violations<a class=headerlink href=#issue-5-foreign-key-constraint-violations title="Permanent link">&para;</a></h4> <p><strong>Symptoms:</strong> - Constraint violation errors during data insertion - Referential integrity issues</p> <p><strong>Solutions:</strong> <div class="language-python highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=c1># Disable constraints during migration</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=n>migration_sequence</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a>    <span class=s2>&quot;disable_foreign_keys&quot;</span><span class=p>,</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a>    <span class=s2>&quot;migrate_parent_tables&quot;</span><span class=p>,</span>
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a>    <span class=s2>&quot;migrate_child_tables&quot;</span><span class=p>,</span>
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a>    <span class=s2>&quot;enable_foreign_keys&quot;</span><span class=p>,</span>
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a>    <span class=s2>&quot;validate_constraints&quot;</span>
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a><span class=p>]</span>
</span><span id=__span-27-9><a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a>
</span><span id=__span-27-10><a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a><span class=c1># Or use dependency-ordered migration</span>
</span><span id=__span-27-11><a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a><span class=n>dependency_order</span> <span class=o>=</span> <span class=n>calculate_table_dependencies</span><span class=p>(</span><span class=n>schema</span><span class=p>)</span>
</span><span id=__span-27-12><a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a><span class=k>for</span> <span class=n>table</span> <span class=ow>in</span> <span class=n>dependency_order</span><span class=p>:</span>
</span><span id=__span-27-13><a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a>    <span class=n>migrate_table</span><span class=p>(</span><span class=n>table</span><span class=p>)</span>
</span></code></pre></div></p> <h3 id=recovery-procedures>Recovery Procedures<a class=headerlink href=#recovery-procedures title="Permanent link">&para;</a></h3> <h4 id=rollback-process>Rollback Process<a class=headerlink href=#rollback-process title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>rollback_migration</span><span class=p>(</span><span class=n>rollback_point</span><span class=o>=</span><span class=s2>&quot;complete&quot;</span><span class=p>):</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>    <span class=n>agent</span> <span class=o>=</span> <span class=n>SupabaseMigrationAgent</span><span class=p>()</span>
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Initiating rollback to: </span><span class=si>{</span><span class=n>rollback_point</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-28-5><a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a>
</span><span id=__span-28-6><a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a>    <span class=k>if</span> <span class=n>rollback_point</span> <span class=o>==</span> <span class=s2>&quot;complete&quot;</span><span class=p>:</span>
</span><span id=__span-28-7><a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a>        <span class=c1># Complete rollback</span>
</span><span id=__span-28-8><a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a>        <span class=k>await</span> <span class=n>agent</span><span class=o>.</span><span class=n>execute_complete_rollback</span><span class=p>()</span>
</span><span id=__span-28-9><a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a>    <span class=k>elif</span> <span class=n>rollback_point</span> <span class=o>==</span> <span class=s2>&quot;data_only&quot;</span><span class=p>:</span>
</span><span id=__span-28-10><a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a>        <span class=c1># Keep schema, rollback data</span>
</span><span id=__span-28-11><a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a>        <span class=k>await</span> <span class=n>agent</span><span class=o>.</span><span class=n>rollback_data_migration</span><span class=p>()</span>
</span><span id=__span-28-12><a id=__codelineno-28-12 name=__codelineno-28-12 href=#__codelineno-28-12></a>    <span class=k>elif</span> <span class=n>rollback_point</span> <span class=o>==</span> <span class=s2>&quot;schema_only&quot;</span><span class=p>:</span>
</span><span id=__span-28-13><a id=__codelineno-28-13 name=__codelineno-28-13 href=#__codelineno-28-13></a>        <span class=c1># Rollback schema changes</span>
</span><span id=__span-28-14><a id=__codelineno-28-14 name=__codelineno-28-14 href=#__codelineno-28-14></a>        <span class=k>await</span> <span class=n>agent</span><span class=o>.</span><span class=n>rollback_schema_migration</span><span class=p>()</span>
</span><span id=__span-28-15><a id=__codelineno-28-15 name=__codelineno-28-15 href=#__codelineno-28-15></a>
</span><span id=__span-28-16><a id=__codelineno-28-16 name=__codelineno-28-16 href=#__codelineno-28-16></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Rollback completed&quot;</span><span class=p>)</span>
</span><span id=__span-28-17><a id=__codelineno-28-17 name=__codelineno-28-17 href=#__codelineno-28-17></a>
</span><span id=__span-28-18><a id=__codelineno-28-18 name=__codelineno-28-18 href=#__codelineno-28-18></a><span class=c1># Execute rollback if needed</span>
</span><span id=__span-28-19><a id=__codelineno-28-19 name=__codelineno-28-19 href=#__codelineno-28-19></a><span class=k>await</span> <span class=n>rollback_migration</span><span class=p>(</span><span class=s2>&quot;complete&quot;</span><span class=p>)</span>
</span></code></pre></div> <h4 id=data-recovery-from-backup>Data Recovery from Backup<a class=headerlink href=#data-recovery-from-backup title="Permanent link">&para;</a></h4> <div class="language-bash highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=c1># Restore from backup if rollback fails</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a>psql<span class=w> </span>-h<span class=w> </span>db.supabase.co<span class=w> </span>-U<span class=w> </span>postgres<span class=w> </span>-d<span class=w> </span>postgres<span class=w> </span>&lt;<span class=w> </span>backups/pre_migration_backup.sql
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a>
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=c1># Selective table restore</span>
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a>pg_restore<span class=w> </span>-h<span class=w> </span>db.supabase.co<span class=w> </span>-U<span class=w> </span>postgres<span class=w> </span>-d<span class=w> </span>postgres<span class=w> </span>-t<span class=w> </span>specific_table<span class=w> </span>backups/table_backup.dump
</span></code></pre></div> <h2 id=post-migration-tasks>Post-Migration Tasks<a class=headerlink href=#post-migration-tasks title="Permanent link">&para;</a></h2> <h3 id=1-application-configuration-updates>1. Application Configuration Updates<a class=headerlink href=#1-application-configuration-updates title="Permanent link">&para;</a></h3> <h4 id=update-connection-strings>Update Connection Strings<a class=headerlink href=#update-connection-strings title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=c1># Update application configuration</span>
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=n>DATABASE_CONFIG</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-30-3><a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a>    <span class=s2>&quot;host&quot;</span><span class=p>:</span> <span class=s2>&quot;db.supabase.co&quot;</span><span class=p>,</span>
</span><span id=__span-30-4><a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a>    <span class=s2>&quot;port&quot;</span><span class=p>:</span> <span class=mi>5432</span><span class=p>,</span>
</span><span id=__span-30-5><a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a>    <span class=s2>&quot;database&quot;</span><span class=p>:</span> <span class=s2>&quot;postgres&quot;</span><span class=p>,</span>
</span><span id=__span-30-6><a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a>    <span class=s2>&quot;user&quot;</span><span class=p>:</span> <span class=s2>&quot;postgres&quot;</span><span class=p>,</span>
</span><span id=__span-30-7><a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a>    <span class=s2>&quot;password&quot;</span><span class=p>:</span> <span class=n>SUPABASE_DB_PASSWORD</span><span class=p>,</span>
</span><span id=__span-30-8><a id=__codelineno-30-8 name=__codelineno-30-8 href=#__codelineno-30-8></a>    <span class=s2>&quot;sslmode&quot;</span><span class=p>:</span> <span class=s2>&quot;require&quot;</span>
</span><span id=__span-30-9><a id=__codelineno-30-9 name=__codelineno-30-9 href=#__codelineno-30-9></a><span class=p>}</span>
</span><span id=__span-30-10><a id=__codelineno-30-10 name=__codelineno-30-10 href=#__codelineno-30-10></a>
</span><span id=__span-30-11><a id=__codelineno-30-11 name=__codelineno-30-11 href=#__codelineno-30-11></a><span class=c1># Update ORM configuration</span>
</span><span id=__span-30-12><a id=__codelineno-30-12 name=__codelineno-30-12 href=#__codelineno-30-12></a><span class=n>SQLALCHEMY_DATABASE_URL</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;postgresql://</span><span class=si>{</span><span class=n>user</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>password</span><span class=si>}</span><span class=s2>@</span><span class=si>{</span><span class=n>host</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>port</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>database</span><span class=si>}</span><span class=s2>&quot;</span>
</span></code></pre></div> <h4 id=update-api-endpoints>Update API Endpoints<a class=headerlink href=#update-api-endpoints title="Permanent link">&para;</a></h4> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=c1>// Update frontend configuration</span>
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=kd>const</span><span class=w> </span><span class=nx>supabaseConfig</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-31-3><a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a><span class=w>  </span><span class=nx>url</span><span class=o>:</span><span class=w> </span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>NEXT_PUBLIC_SUPABASE_URL</span><span class=p>,</span>
</span><span id=__span-31-4><a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a><span class=w>  </span><span class=nx>anonKey</span><span class=o>:</span><span class=w> </span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>NEXT_PUBLIC_SUPABASE_ANON_KEY</span><span class=p>,</span>
</span><span id=__span-31-5><a id=__codelineno-31-5 name=__codelineno-31-5 href=#__codelineno-31-5></a><span class=w>  </span><span class=nx>serviceRoleKey</span><span class=o>:</span><span class=w> </span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>SUPABASE_SERVICE_ROLE_KEY</span><span class=w>  </span><span class=c1>// Server-side only</span>
</span><span id=__span-31-6><a id=__codelineno-31-6 name=__codelineno-31-6 href=#__codelineno-31-6></a><span class=p>}</span>
</span><span id=__span-31-7><a id=__codelineno-31-7 name=__codelineno-31-7 href=#__codelineno-31-7></a>
</span><span id=__span-31-8><a id=__codelineno-31-8 name=__codelineno-31-8 href=#__codelineno-31-8></a><span class=c1>// Initialize Supabase client</span>
</span><span id=__span-31-9><a id=__codelineno-31-9 name=__codelineno-31-9 href=#__codelineno-31-9></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>createClient</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s1>&#39;@supabase/supabase-js&#39;</span>
</span><span id=__span-31-10><a id=__codelineno-31-10 name=__codelineno-31-10 href=#__codelineno-31-10></a><span class=kd>const</span><span class=w> </span><span class=nx>supabase</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createClient</span><span class=p>(</span><span class=nx>supabaseConfig</span><span class=p>.</span><span class=nx>url</span><span class=p>,</span><span class=w> </span><span class=nx>supabaseConfig</span><span class=p>.</span><span class=nx>anonKey</span><span class=p>)</span>
</span></code></pre></div> <h3 id=2-security-hardening>2. Security Hardening<a class=headerlink href=#2-security-hardening title="Permanent link">&para;</a></h3> <h4 id=review-and-optimize-rls-policies>Review and Optimize RLS Policies<a class=headerlink href=#review-and-optimize-rls-policies title="Permanent link">&para;</a></h4> <div class="language-sql highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=c1>-- Review all policies</span>
</span><span id=__span-32-2><a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class=k>SELECT</span>
</span><span id=__span-32-3><a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=w>    </span><span class=n>schemaname</span><span class=p>,</span>
</span><span id=__span-32-4><a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class=w>    </span><span class=n>tablename</span><span class=p>,</span>
</span><span id=__span-32-5><a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a><span class=w>    </span><span class=n>policyname</span><span class=p>,</span>
</span><span id=__span-32-6><a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a><span class=w>    </span><span class=n>roles</span><span class=p>,</span>
</span><span id=__span-32-7><a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a><span class=w>    </span><span class=n>cmd</span><span class=p>,</span>
</span><span id=__span-32-8><a id=__codelineno-32-8 name=__codelineno-32-8 href=#__codelineno-32-8></a><span class=w>    </span><span class=n>qual</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>using_clause</span><span class=p>,</span>
</span><span id=__span-32-9><a id=__codelineno-32-9 name=__codelineno-32-9 href=#__codelineno-32-9></a><span class=w>    </span><span class=n>with_check</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>check_clause</span>
</span><span id=__span-32-10><a id=__codelineno-32-10 name=__codelineno-32-10 href=#__codelineno-32-10></a><span class=k>FROM</span><span class=w> </span><span class=n>pg_policies</span>
</span><span id=__span-32-11><a id=__codelineno-32-11 name=__codelineno-32-11 href=#__codelineno-32-11></a><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>schemaname</span><span class=p>,</span><span class=w> </span><span class=n>tablename</span><span class=p>,</span><span class=w> </span><span class=n>policyname</span><span class=p>;</span>
</span><span id=__span-32-12><a id=__codelineno-32-12 name=__codelineno-32-12 href=#__codelineno-32-12></a>
</span><span id=__span-32-13><a id=__codelineno-32-13 name=__codelineno-32-13 href=#__codelineno-32-13></a><span class=c1>-- Test policy performance</span>
</span><span id=__span-32-14><a id=__codelineno-32-14 name=__codelineno-32-14 href=#__codelineno-32-14></a><span class=k>EXPLAIN</span><span class=w> </span><span class=p>(</span><span class=k>ANALYZE</span><span class=p>,</span><span class=w> </span><span class=n>BUFFERS</span><span class=p>)</span>
</span><span id=__span-32-15><a id=__codelineno-32-15 name=__codelineno-32-15 href=#__codelineno-32-15></a><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>lessons</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>organization_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;test-org&#39;</span><span class=p>;</span>
</span></code></pre></div> <h4 id=configure-api-security>Configure API Security<a class=headerlink href=#configure-api-security title="Permanent link">&para;</a></h4> <div class="language-sql highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=c1>-- Set up API rate limiting</span>
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>auth</span><span class=p>.</span><span class=n>rate_limits</span><span class=w> </span><span class=p>(</span><span class=n>identifier</span><span class=p>,</span><span class=w> </span><span class=n>action</span><span class=p>,</span><span class=w> </span><span class=n>limit_per_hour</span><span class=p>)</span>
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=k>VALUES</span>
</span><span id=__span-33-4><a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=w>    </span><span class=p>(</span><span class=s1>&#39;anon&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;select&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>1000</span><span class=p>),</span>
</span><span id=__span-33-5><a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a><span class=w>    </span><span class=p>(</span><span class=s1>&#39;authenticated&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;select&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>10000</span><span class=p>),</span>
</span><span id=__span-33-6><a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a><span class=w>    </span><span class=p>(</span><span class=s1>&#39;authenticated&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;insert&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>1000</span><span class=p>);</span>
</span><span id=__span-33-7><a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a>
</span><span id=__span-33-8><a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a><span class=c1>-- Configure CORS settings</span>
</span><span id=__span-33-9><a id=__codelineno-33-9 name=__codelineno-33-9 href=#__codelineno-33-9></a><span class=k>UPDATE</span><span class=w> </span><span class=n>auth</span><span class=p>.</span><span class=n>config</span>
</span><span id=__span-33-10><a id=__codelineno-33-10 name=__codelineno-33-10 href=#__codelineno-33-10></a><span class=k>SET</span><span class=w> </span><span class=n>cors_allowed_origins</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;[&quot;https://yourdomain.com&quot;, &quot;https://app.yourdomain.com&quot;]&#39;</span>
</span><span id=__span-33-11><a id=__codelineno-33-11 name=__codelineno-33-11 href=#__codelineno-33-11></a><span class=k>WHERE</span><span class=w> </span><span class=k>key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;cors&#39;</span><span class=p>;</span>
</span></code></pre></div> <h3 id=3-performance-optimization>3. Performance Optimization<a class=headerlink href=#3-performance-optimization title="Permanent link">&para;</a></h3> <h4 id=create-necessary-indexes>Create Necessary Indexes<a class=headerlink href=#create-necessary-indexes title="Permanent link">&para;</a></h4> <div class="language-sql highlight"><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=c1>-- Create performance indexes</span>
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>CONCURRENTLY</span><span class=w> </span><span class=n>idx_lessons_organization_id</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>lessons</span><span class=p>(</span><span class=n>organization_id</span><span class=p>);</span>
</span><span id=__span-34-3><a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>CONCURRENTLY</span><span class=w> </span><span class=n>idx_enrollments_student_id</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>enrollments</span><span class=p>(</span><span class=n>student_id</span><span class=p>);</span>
</span><span id=__span-34-4><a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>CONCURRENTLY</span><span class=w> </span><span class=n>idx_lessons_search</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>lessons</span><span class=w> </span><span class=k>USING</span><span class=w> </span><span class=n>gin</span><span class=p>(</span><span class=n>to_tsvector</span><span class=p>(</span><span class=s1>&#39;english&#39;</span><span class=p>,</span><span class=w> </span><span class=n>title</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=s1>&#39; &#39;</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>content</span><span class=p>));</span>
</span><span id=__span-34-5><a id=__codelineno-34-5 name=__codelineno-34-5 href=#__codelineno-34-5></a>
</span><span id=__span-34-6><a id=__codelineno-34-6 name=__codelineno-34-6 href=#__codelineno-34-6></a><span class=c1>-- Vector similarity indexes</span>
</span><span id=__span-34-7><a id=__codelineno-34-7 name=__codelineno-34-7 href=#__codelineno-34-7></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>CONCURRENTLY</span><span class=w> </span><span class=n>idx_content_embeddings</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>lesson_embeddings</span>
</span><span id=__span-34-8><a id=__codelineno-34-8 name=__codelineno-34-8 href=#__codelineno-34-8></a><span class=k>USING</span><span class=w> </span><span class=n>ivfflat</span><span class=w> </span><span class=p>(</span><span class=n>embedding</span><span class=w> </span><span class=n>vector_cosine_ops</span><span class=p>)</span><span class=w> </span><span class=k>WITH</span><span class=w> </span><span class=p>(</span><span class=n>lists</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>100</span><span class=p>);</span>
</span></code></pre></div> <h4 id=configure-connection-pooling>Configure Connection Pooling<a class=headerlink href=#configure-connection-pooling title="Permanent link">&para;</a></h4> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-35-1><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=c1>// Use connection pooling for high-traffic applications</span>
</span><span id=__span-35-2><a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>Pool</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;pg&#39;</span><span class=p>)</span>
</span><span id=__span-35-3><a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a>
</span><span id=__span-35-4><a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a><span class=kd>const</span><span class=w> </span><span class=nx>pool</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>Pool</span><span class=p>({</span>
</span><span id=__span-35-5><a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a><span class=w>  </span><span class=nx>host</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;db.supabase.co&#39;</span><span class=p>,</span>
</span><span id=__span-35-6><a id=__codelineno-35-6 name=__codelineno-35-6 href=#__codelineno-35-6></a><span class=w>  </span><span class=nx>port</span><span class=o>:</span><span class=w> </span><span class=mf>5432</span><span class=p>,</span>
</span><span id=__span-35-7><a id=__codelineno-35-7 name=__codelineno-35-7 href=#__codelineno-35-7></a><span class=w>  </span><span class=nx>database</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;postgres&#39;</span><span class=p>,</span>
</span><span id=__span-35-8><a id=__codelineno-35-8 name=__codelineno-35-8 href=#__codelineno-35-8></a><span class=w>  </span><span class=nx>user</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;postgres&#39;</span><span class=p>,</span>
</span><span id=__span-35-9><a id=__codelineno-35-9 name=__codelineno-35-9 href=#__codelineno-35-9></a><span class=w>  </span><span class=nx>password</span><span class=o>:</span><span class=w> </span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>SUPABASE_DB_PASSWORD</span><span class=p>,</span>
</span><span id=__span-35-10><a id=__codelineno-35-10 name=__codelineno-35-10 href=#__codelineno-35-10></a><span class=w>  </span><span class=nx>max</span><span class=o>:</span><span class=w> </span><span class=mf>20</span><span class=p>,</span><span class=w>           </span><span class=c1>// Maximum connections</span>
</span><span id=__span-35-11><a id=__codelineno-35-11 name=__codelineno-35-11 href=#__codelineno-35-11></a><span class=w>  </span><span class=nx>idleTimeoutMillis</span><span class=o>:</span><span class=w> </span><span class=mf>30000</span><span class=p>,</span>
</span><span id=__span-35-12><a id=__codelineno-35-12 name=__codelineno-35-12 href=#__codelineno-35-12></a><span class=w>  </span><span class=nx>connectionTimeoutMillis</span><span class=o>:</span><span class=w> </span><span class=mf>2000</span><span class=p>,</span>
</span><span id=__span-35-13><a id=__codelineno-35-13 name=__codelineno-35-13 href=#__codelineno-35-13></a><span class=p>})</span>
</span></code></pre></div> <h3 id=4-monitoring-and-alerting>4. Monitoring and Alerting<a class=headerlink href=#4-monitoring-and-alerting title="Permanent link">&para;</a></h3> <h4 id=set-up-monitoring>Set Up Monitoring<a class=headerlink href=#set-up-monitoring title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=c1># Configure application monitoring</span>
</span><span id=__span-36-2><a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a><span class=n>MONITORING_CONFIG</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-36-3><a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a>    <span class=s2>&quot;database_metrics&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-36-4><a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a>        <span class=s2>&quot;connection_count&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-36-5><a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a>        <span class=s2>&quot;query_performance&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-36-6><a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a>        <span class=s2>&quot;error_rates&quot;</span><span class=p>:</span> <span class=kc>True</span>
</span><span id=__span-36-7><a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a>    <span class=p>},</span>
</span><span id=__span-36-8><a id=__codelineno-36-8 name=__codelineno-36-8 href=#__codelineno-36-8></a>    <span class=s2>&quot;application_metrics&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-36-9><a id=__codelineno-36-9 name=__codelineno-36-9 href=#__codelineno-36-9></a>        <span class=s2>&quot;api_response_times&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-36-10><a id=__codelineno-36-10 name=__codelineno-36-10 href=#__codelineno-36-10></a>        <span class=s2>&quot;user_activity&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-36-11><a id=__codelineno-36-11 name=__codelineno-36-11 href=#__codelineno-36-11></a>        <span class=s2>&quot;feature_usage&quot;</span><span class=p>:</span> <span class=kc>True</span>
</span><span id=__span-36-12><a id=__codelineno-36-12 name=__codelineno-36-12 href=#__codelineno-36-12></a>    <span class=p>},</span>
</span><span id=__span-36-13><a id=__codelineno-36-13 name=__codelineno-36-13 href=#__codelineno-36-13></a>    <span class=s2>&quot;alerts&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-36-14><a id=__codelineno-36-14 name=__codelineno-36-14 href=#__codelineno-36-14></a>        <span class=s2>&quot;high_error_rate&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;threshold&quot;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span> <span class=s2>&quot;window&quot;</span><span class=p>:</span> <span class=s2>&quot;5m&quot;</span><span class=p>},</span>
</span><span id=__span-36-15><a id=__codelineno-36-15 name=__codelineno-36-15 href=#__codelineno-36-15></a>        <span class=s2>&quot;slow_queries&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;threshold&quot;</span><span class=p>:</span> <span class=mi>1000</span><span class=p>,</span> <span class=s2>&quot;unit&quot;</span><span class=p>:</span> <span class=s2>&quot;ms&quot;</span><span class=p>},</span>
</span><span id=__span-36-16><a id=__codelineno-36-16 name=__codelineno-36-16 href=#__codelineno-36-16></a>        <span class=s2>&quot;connection_limit&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;threshold&quot;</span><span class=p>:</span> <span class=mi>80</span><span class=p>,</span> <span class=s2>&quot;unit&quot;</span><span class=p>:</span> <span class=s2>&quot;percent&quot;</span><span class=p>}</span>
</span><span id=__span-36-17><a id=__codelineno-36-17 name=__codelineno-36-17 href=#__codelineno-36-17></a>    <span class=p>}</span>
</span><span id=__span-36-18><a id=__codelineno-36-18 name=__codelineno-36-18 href=#__codelineno-36-18></a><span class=p>}</span>
</span></code></pre></div> <h4 id=create-health-check-endpoints>Create Health Check Endpoints<a class=headerlink href=#create-health-check-endpoints title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=kn>from</span><span class=w> </span><span class=nn>fastapi</span><span class=w> </span><span class=kn>import</span> <span class=n>FastAPI</span>
</span><span id=__span-37-2><a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=kn>from</span><span class=w> </span><span class=nn>supabase</span><span class=w> </span><span class=kn>import</span> <span class=n>create_client</span>
</span><span id=__span-37-3><a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a>
</span><span id=__span-37-4><a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span><span id=__span-37-5><a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a>
</span><span id=__span-37-6><a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;/health&quot;</span><span class=p>)</span>
</span><span id=__span-37-7><a id=__codelineno-37-7 name=__codelineno-37-7 href=#__codelineno-37-7></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>health_check</span><span class=p>():</span>
</span><span id=__span-37-8><a id=__codelineno-37-8 name=__codelineno-37-8 href=#__codelineno-37-8></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-37-9><a id=__codelineno-37-9 name=__codelineno-37-9 href=#__codelineno-37-9></a>        <span class=c1># Test database connectivity</span>
</span><span id=__span-37-10><a id=__codelineno-37-10 name=__codelineno-37-10 href=#__codelineno-37-10></a>        <span class=n>supabase</span> <span class=o>=</span> <span class=n>create_client</span><span class=p>(</span><span class=n>SUPABASE_URL</span><span class=p>,</span> <span class=n>SUPABASE_SERVICE_ROLE_KEY</span><span class=p>)</span>
</span><span id=__span-37-11><a id=__codelineno-37-11 name=__codelineno-37-11 href=#__codelineno-37-11></a>        <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>supabase</span><span class=o>.</span><span class=n>from</span><span class=p>(</span><span class=s1>&#39;users&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>select</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>limit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>()</span>
</span><span id=__span-37-12><a id=__codelineno-37-12 name=__codelineno-37-12 href=#__codelineno-37-12></a>
</span><span id=__span-37-13><a id=__codelineno-37-13 name=__codelineno-37-13 href=#__codelineno-37-13></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-37-14><a id=__codelineno-37-14 name=__codelineno-37-14 href=#__codelineno-37-14></a>            <span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=s2>&quot;healthy&quot;</span><span class=p>,</span>
</span><span id=__span-37-15><a id=__codelineno-37-15 name=__codelineno-37-15 href=#__codelineno-37-15></a>            <span class=s2>&quot;database&quot;</span><span class=p>:</span> <span class=s2>&quot;connected&quot;</span><span class=p>,</span>
</span><span id=__span-37-16><a id=__codelineno-37-16 name=__codelineno-37-16 href=#__codelineno-37-16></a>            <span class=s2>&quot;timestamp&quot;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span><span id=__span-37-17><a id=__codelineno-37-17 name=__codelineno-37-17 href=#__codelineno-37-17></a>        <span class=p>}</span>
</span><span id=__span-37-18><a id=__codelineno-37-18 name=__codelineno-37-18 href=#__codelineno-37-18></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-37-19><a id=__codelineno-37-19 name=__codelineno-37-19 href=#__codelineno-37-19></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-37-20><a id=__codelineno-37-20 name=__codelineno-37-20 href=#__codelineno-37-20></a>            <span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=s2>&quot;unhealthy&quot;</span><span class=p>,</span>
</span><span id=__span-37-21><a id=__codelineno-37-21 name=__codelineno-37-21 href=#__codelineno-37-21></a>            <span class=s2>&quot;error&quot;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span>
</span><span id=__span-37-22><a id=__codelineno-37-22 name=__codelineno-37-22 href=#__codelineno-37-22></a>            <span class=s2>&quot;timestamp&quot;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span><span id=__span-37-23><a id=__codelineno-37-23 name=__codelineno-37-23 href=#__codelineno-37-23></a>        <span class=p>}</span>
</span></code></pre></div> <h2 id=best-practices>Best Practices<a class=headerlink href=#best-practices title="Permanent link">&para;</a></h2> <h3 id=1-planning-phase-best-practices>1. Planning Phase Best Practices<a class=headerlink href=#1-planning-phase-best-practices title="Permanent link">&para;</a></h3> <ul> <li><strong>Start with Analysis</strong>: Always perform comprehensive analysis before planning</li> <li><strong>Document Everything</strong>: Keep detailed records of decisions and rationale</li> <li><strong>Plan for Rollback</strong>: Design rollback procedures for every migration phase</li> <li><strong>Test with Subsets</strong>: Use sample data for initial testing</li> <li><strong>Stakeholder Communication</strong>: Keep all stakeholders informed of progress and risks</li> </ul> <h3 id=2-execution-phase-best-practices>2. Execution Phase Best Practices<a class=headerlink href=#2-execution-phase-best-practices title="Permanent link">&para;</a></h3> <ul> <li><strong>Always Start with Dry Run</strong>: Never skip the dry run phase</li> <li><strong>Monitor Progress</strong>: Use real-time monitoring during migration</li> <li><strong>Validate Each Phase</strong>: Don't proceed until each phase is validated</li> <li><strong>Maintain Backups</strong>: Keep multiple backup copies during migration</li> <li><strong>Document Issues</strong>: Record any issues and resolutions for future reference</li> </ul> <h3 id=3-security-best-practices>3. Security Best Practices<a class=headerlink href=#3-security-best-practices title="Permanent link">&para;</a></h3> <ul> <li><strong>Principle of Least Privilege</strong>: Grant minimum necessary permissions</li> <li><strong>Regular Security Audits</strong>: Review RLS policies regularly</li> <li><strong>Encrypt Sensitive Data</strong>: Use Supabase encryption features</li> <li><strong>Monitor Access Patterns</strong>: Track unusual access patterns</li> <li><strong>Implement Audit Logging</strong>: Log all significant database operations</li> </ul> <h3 id=4-performance-best-practices>4. Performance Best Practices<a class=headerlink href=#4-performance-best-practices title="Permanent link">&para;</a></h3> <ul> <li><strong>Index Strategy</strong>: Plan indexes before data migration</li> <li><strong>Batch Optimization</strong>: Tune batch sizes for your data patterns</li> <li><strong>Connection Management</strong>: Use appropriate connection pooling</li> <li><strong>Query Optimization</strong>: Review and optimize slow queries</li> <li><strong>Monitoring</strong>: Implement comprehensive performance monitoring</li> </ul> <h3 id=5-maintenance-best-practices>5. Maintenance Best Practices<a class=headerlink href=#5-maintenance-best-practices title="Permanent link">&para;</a></h3> <ul> <li><strong>Regular Updates</strong>: Keep Supabase and dependencies updated</li> <li><strong>Backup Strategy</strong>: Implement automated backup procedures</li> <li><strong>Documentation</strong>: Maintain up-to-date documentation</li> <li><strong>Disaster Recovery</strong>: Test disaster recovery procedures regularly</li> <li><strong>Performance Reviews</strong>: Conduct regular performance reviews</li> </ul> <hr> <p><em>Migration Guide Version: 1.0.0</em> <em>Last Updated: 2025-09-21</em> <em>Compatible with: ToolBoxAI Platform v1.1.0+, Supabase Latest</em></p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="September 28, 2025 02:20:28 UTC"><span class=timeago datetime=2025-09-28T02:20:28+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="September 28, 2025 02:20:28 UTC">2025-09-28</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Created> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="September 22, 2025 00:05:02 UTC"><span class=timeago datetime=2025-09-22T00:05:02+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="September 22, 2025 00:05:02 UTC">2025-09-22</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Contributors> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 4a4 4 0 0 1 4 4 4 4 0 0 1-4 4 4 4 0 0 1-4-4 4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4"/></svg> </span> <nav> <a href=mailto:140660682+grayghostdev@users.noreply.github.com>GrayGhostDev</a> </nav> </span> </aside> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2025 ToolBoxAI Solutions </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/ToolBoxAI-Solutions target=_blank rel=noopener title="ToolBoxAI on GitHub" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://discord.gg/toolboxai target=_blank rel=noopener title="ToolBoxAI on Discord" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"/></svg> </a> <a href=https://twitter.com/toolboxai target=_blank rel=noopener title="ToolBoxAI on Twitter" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">Accept</button> <label class=md-button for=__settings>Manage settings</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script> <script id=__config type=application/json>{"base": "../../../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tabs.link", "content.tooltips", "header.autohide", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.path", "navigation.prune", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.integrate"], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script> <script src=../../../../assets/javascripts/bundle.f55a23d4.min.js></script> <script src=../../../../js/timeago.min.js></script> <script src=../../../../js/timeago_mkdocs_material.js></script> <script src=../../../../javascripts/extra.js></script> <script src=../../../../javascripts/mathjax.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>