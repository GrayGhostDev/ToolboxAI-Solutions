# ============================================
# TOOLBOXAI SOLUTIONS - MASTER ENVIRONMENT TEMPLATE
# ============================================
# Copy this file to .env and fill in your actual values
# NEVER commit .env with real credentials to version control
# Updated: 2025-09-26
# ============================================

# ============================================
# ENVIRONMENT SETTINGS
# ============================================
ENVIRONMENT=development  # development | staging | production
DEBUG=true              # Set to false in production
LOG_LEVEL=INFO          # DEBUG | INFO | WARNING | ERROR
NODE_ENV=development    # development | production

# ============================================
# APPLICATION CONFIGURATION
# ============================================
# Backend API Settings
FASTAPI_HOST=127.0.0.1
FASTAPI_PORT=8009
HOST=0.0.0.0
PORT=8009
WORKERS=4

# Frontend Settings (for dashboard)
VITE_API_BASE_URL=http://127.0.0.1:8009
VITE_WS_URL=ws://127.0.0.1:8009
VITE_NODE_ENV=development

# CORS and Security
TRUSTED_HOSTS=localhost,127.0.0.1,testserver
ALLOWED_HOSTS=localhost,127.0.0.1,toolboxai.local
CORS_ORIGINS=http://localhost:5179,http://127.0.0.1:5179

# ============================================
# DATABASE CONFIGURATION
# ============================================
# PostgreSQL Database (Primary)
POSTGRES_DB=toolboxai_dev
POSTGRES_USER=dbuser
POSTGRES_PASSWORD=your_secure_postgres_password_here
DATABASE_URL=postgresql://dbuser:your_secure_postgres_password_here@localhost:5432/toolboxai_dev
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=40

# Redis Cache & Sessions
REDIS_URL=redis://:your_redis_password_here@localhost:6379/0
REDIS_PASSWORD=your_redis_password_here
REDIS_MAX_CONNECTIONS=100
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0

# ============================================
# SECURITY CONFIGURATION
# ============================================
# JWT Authentication (Generate with: openssl rand -hex 32)
JWT_SECRET_KEY=generate_a_secure_random_key_here_minimum_32_chars
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# Session Security
SESSION_SECRET=generate_another_secure_random_key_here
ENCRYPTION_KEY=generate_encryption_key_here

# SSL & Security Headers
SECURE_SSL_REDIRECT=false  # Set to true in production
SESSION_COOKIE_SECURE=false  # Set to true in production with HTTPS
CSRF_COOKIE_SECURE=false     # Set to true in production with HTTPS
SECURE_HSTS_SECONDS=31536000
SECURE_HSTS_INCLUDE_SUBDOMAINS=true
SECURE_HSTS_PRELOAD=true

# Admin Account (CHANGE IMMEDIATELY!)
ADMIN_USERNAME=admin
ADMIN_PASSWORD=change_me_immediately
ADMIN_EMAIL=admin@toolboxai.local

# ============================================
# HASHICORP VAULT - SECRET MANAGEMENT
# ============================================
# HashiCorp Vault provides dynamic secret management, automatic rotation,
# fine-grained access control, and comprehensive audit logging.
# Sign up at https://www.hashicorp.com/products/vault or use self-hosted
#
# VAULT_ENABLED: Set to 'true' to use Vault for secret management (default: false)
#   When enabled, backend will fetch secrets from Vault instead of environment variables
#   Provides: Dynamic database credentials, automatic rotation, audit logging
#
# VAULT_ADDR: Vault server address
#   Development: http://vault:8200 (Docker network) or http://localhost:8200 (host)
#   Production: https://vault.your-domain.com:8200 (must use HTTPS)
#
# VAULT_TOKEN: Authentication token for Vault API
#   Development: Use VAULT_DEV_ROOT_TOKEN from init-vault.sh output
#   Production: Use service token created with 'backend' policy
#   Generate: vault token create -policy=backend -period=24h
#   SECURITY: Keep this secure! Grants access to all secrets
#
# VAULT_NAMESPACE: Vault namespace (optional, Enterprise feature)
#   Use for multi-tenant Vault deployments
#   Leave empty for Vault OSS (open-source)
#
# VAULT_SKIP_VERIFY: Skip TLS certificate verification (DEVELOPMENT ONLY!)
#   Set to 'true' only in development with self-signed certificates
#   NEVER set to 'true' in production - use valid TLS certificates
#
# Setup Instructions:
# 1. Start Vault: docker compose up vault -d
# 2. Initialize: infrastructure/vault/scripts/init-vault.sh
# 3. Populate secrets: infrastructure/vault/scripts/populate-secrets.sh
# 4. Get backend token: docker exec toolboxai-vault vault token create -policy=backend
# 5. Set VAULT_TOKEN to the token from step 4
# 6. Set VAULT_ENABLED=true to activate
#
# Dynamic Credentials:
# When Vault is enabled, database credentials are dynamically generated:
# - New credentials issued on application start
# - Automatic rotation (default: 1h TTL, 24h max)
# - Credentials automatically revoked when application stops
# - No need to manually manage DATABASE_URL password
#
# Secret Rotation:
# Run: infrastructure/vault/scripts/rotate-secrets.sh
# Schedule: Weekly for database, monthly for API keys
#
VAULT_ENABLED=false
VAULT_ADDR=http://vault:8200
VAULT_TOKEN=your_vault_token_here
VAULT_NAMESPACE=
VAULT_SKIP_VERIFY=false

# Development Mode (DEVELOPMENT ONLY - DO NOT USE IN PRODUCTION)
# For local development, Vault runs in dev mode with in-memory storage
# Dev mode uses a static root token for easy testing
# SECURITY: Dev mode is insecure - use production mode for staging/production
VAULT_DEV_ROOT_TOKEN=devtoken

# ============================================
# EXTERNAL SERVICES - AI PROVIDERS
# ============================================
# OpenAI Configuration
OPENAI_API_KEY=sk-proj-your_openai_api_key_here
OPENAI_MODEL=gpt-4
OPENAI_TEMPERATURE=0.7

# Anthropic Claude API
ANTHROPIC_API_KEY=sk-ant-your_anthropic_api_key_here

# Replicate API (for additional AI models)
REPLICATE_API_TOKEN=r8_your_replicate_token_here

# Google AI API
GOOGLE_AI_API_KEY=your_google_ai_api_key_here

# ============================================
# WEEK 2: PRODUCTION FEATURES (September 2025)
# ============================================
# Redis Cloud Integration (TLS required for production)
# Get credentials from: https://app.redislabs.com/
REDIS_CLOUD_ENABLED=false
REDIS_CLOUD_URL=rediss://username:password@endpoint:port
REDIS_CLOUD_CA_CERT_PATH=config/certificates/redis-cloud-ca.pem
REDIS_CLOUD_CONNECTION_POOL_SIZE=50

# LangCache Semantic Caching (Public Preview 2025)
# Sign up at: https://redis.io/langcache/
LANGCACHE_ENABLED=false
LANGCACHE_API_KEY=your_langcache_api_key_here
LANGCACHE_CACHE_ID=your_cache_id_here
LANGCACHE_SERVER_URL=https://gcp-us-east4.langcache.redis.io
LANGCACHE_SIMILARITY_THRESHOLD=0.95

# API Key Management
API_KEY_MANAGER_ENABLED=true
API_KEY_ROTATION_DAYS=90
API_KEY_RATE_LIMIT_PER_MINUTE=60

# Enhanced Backup System
BACKUP_ENABLED=false
BACKUP_S3_BUCKET=your-backup-bucket
BACKUP_ENCRYPTION_KEY=generate_with_openssl_rand_hex_16
BACKUP_RETENTION_DAYS=30

# Migration Management
MIGRATION_AUTO_RUN=false
MIGRATION_STRATEGY=blue-green
MIGRATION_ROLLBACK_ON_ERROR=true

# ============================================
# LANGCHAIN & OBSERVABILITY
# ============================================
# LangChain Configuration
LANGCHAIN_API_KEY=your_langchain_api_key_here
LANGCHAIN_PROJECT=ToolboxAI-Solutions
LANGCHAIN_TRACING_V2=true
LANGCHAIN_ENDPOINT=https://api.smith.langchain.com

# LangSmith (Monitoring & Observability)
LANGSMITH_API_KEY=your_langsmith_api_key_here
LANGSMITH_PROJECT=ToolboxAI-Solutions
LANGSMITH_ENDPOINT=https://api.smith.langchain.com

# ============================================
# REAL-TIME COMMUNICATION
# ============================================
# Pusher Channels - Managed WebSocket infrastructure for real-time features
# Sign up at https://pusher.com (free tier: 200k messages/day, 100 connections)
# Provides: Real-time notifications, live updates, presence detection, message history
#
# PUSHER_ENABLED: Set to 'true' to enable Pusher integration (default: false)
# PUSHER_APP_ID: Your Pusher application ID from dashboard
# PUSHER_KEY: Public key for client connections (safe to expose)
# PUSHER_SECRET: Private key for server-side operations (keep secure!)
# PUSHER_CLUSTER: Geographic cluster (us2, eu, ap1, ap2, etc.)
# PUSHER_SSL: Use TLS encryption (recommended: true for production)
#
# Channels used:
# - public-dashboard: General dashboard updates
# - public-notifications: User notifications
# - private-admin: Admin-only events
# - private-teacher: Teacher-specific updates
# - private-student: Student-specific updates
# - agent-*: AI agent status and task updates
#
PUSHER_ENABLED=false
PUSHER_APP_ID=your_pusher_app_id
PUSHER_KEY=your_pusher_key
PUSHER_SECRET=your_pusher_secret
PUSHER_CLUSTER=us2
PUSHER_SSL=true

# Frontend Pusher Config (must match backend configuration)
# VITE_PUSHER_KEY: Same as PUSHER_KEY above (public, safe to expose)
# VITE_PUSHER_CLUSTER: Same as PUSHER_CLUSTER above
# VITE_PUSHER_AUTH_ENDPOINT: Backend endpoint for private/presence channel auth
VITE_PUSHER_KEY=your_pusher_key_here
VITE_PUSHER_CLUSTER=us2
VITE_PUSHER_AUTH_ENDPOINT=/api/v1/pusher/auth

# WebSocket Configuration
ENABLE_WEBSOCKET=true
VITE_ENABLE_WEBSOCKET=true

# ============================================
# SUPABASE INTEGRATION
# ============================================
# IMPORTANT: Copy these values from your Supabase project dashboard
# Get credentials from: https://supabase.com/dashboard → Your Project → Settings → API
# Database URL uses connection pooler (port 6543) for production
SUPABASE_URL=https://your-project-id.supabase.co
SUPABASE_ANON_KEY=your_supabase_anon_public_key_here
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key_here
SUPABASE_DATABASE_URL=postgresql://postgres:your_database_password@db.your-project-id.supabase.co:6543/postgres?sslmode=require
SUPABASE_STORAGE_BUCKET=your-bucket-name

# Supabase S3-Compatible Storage (Optional - for S3 SDK compatibility)
# Get credentials from: https://supabase.com/dashboard → Your Project → Settings → S3 Access Keys
SUPABASE_S3_ENDPOINT=https://your-project-id.storage.supabase.co/storage/v1/s3
SUPABASE_S3_REGION=us-east-1
SUPABASE_S3_ACCESS_KEY_ID=your_s3_access_key_id_here
SUPABASE_S3_SECRET_ACCESS_KEY=your_s3_secret_access_key_here

# Frontend Supabase Config
VITE_SUPABASE_URL=https://your-project-id.supabase.co
VITE_SUPABASE_ANON_KEY=your_supabase_anon_public_key_here

# Note: For production deployment, set DATABASE_URL to SUPABASE_DATABASE_URL

# ============================================
# AUTHENTICATION PROVIDERS
# ============================================
# Clerk Authentication (Optional)
VITE_CLERK_PUBLISHABLE_KEY=pk_test_your_clerk_key_here
VITE_CLERK_SIGN_IN_URL=/sign-in
VITE_CLERK_SIGN_UP_URL=/sign-up
VITE_CLERK_USER_PROFILE_URL=/user
VITE_CLERK_AFTER_SIGN_IN_URL=/dashboard
VITE_CLERK_AFTER_SIGN_UP_URL=/dashboard
VITE_CLERK_AFTER_SIGN_OUT_URL=/

# Google OAuth
GOOGLE_CLIENT_ID=your_google_client_id_here
GOOGLE_CLIENT_SECRET=your_google_client_secret_here
VITE_GOOGLE_CLASSROOM_CLIENT_ID=your_client_id_here

# GitHub OAuth
GITHUB_CLIENT_ID=your_github_client_id_here
GITHUB_CLIENT_SECRET=your_github_client_secret_here
GITHUB_TOKEN=your_github_token_here

# ============================================
# ROBLOX INTEGRATION
# ============================================
# Core Roblox Settings
ROBLOX_UNIVERSE_ID=8505376973
ROBLOX_CLIENT_ID=2214511122270781418
ROBLOX_CLIENT_SECRET=your_roblox_client_secret_here
ROBLOX_API_KEY=your_roblox_api_key_here

# Roblox Plugin & Studio Integration
ROBLOX_PLUGIN_PORT=64989
ROBLOX_STUDIO_PORT=8765
ROBLOX_API_BASE=https://api.roblox.com

# Roblox OAuth2 Settings
ROBLOX_OAUTH_REDIRECT_URI=http://127.0.0.1:8009/api/v1/roblox/oauth/callback
ROBLOX_OAUTH_SCOPES=asset:read,asset:write,data-store:read,data-store:write

# Roblox Webhooks & Security
ROBLOX_WEBHOOK_URL=your_webhook_url_here
ROBLOX_WEBHOOK_SECRET=your_webhook_secret_here

# Frontend Roblox Config
VITE_ROBLOX_API_URL=https://api.roblox.com
VITE_ROBLOX_UNIVERSE_ID=8505376973
VITE_ROBLOX_CLIENT_ID=2214511122270781418
VITE_ROBLOX_PLUGIN_PORT=64989

# ============================================
# FEATURE FLAGS
# ============================================
# Core Features
ENABLE_ROBLOX_INTEGRATION=true
ENABLE_GAMIFICATION=true
ENABLE_ANALYTICS=true
ENABLE_2FA=false
ENABLE_GITHUB_INTEGRATION=false
ENABLE_AI_CHAT=true
ENABLE_METRICS=true

# Frontend Feature Flags
VITE_ENABLE_CLERK_AUTH=false
VITE_ENABLE_ROBLOX_INTEGRATION=true
VITE_ENABLE_GAMIFICATION=true
VITE_ENABLE_ANALYTICS=true
VITE_ENABLE_2FA=true
VITE_ENABLE_GITHUB_INTEGRATION=true
VITE_ENABLE_AI_CHAT=true
VITE_E2E_TESTING=false

# Roblox Limits
ROBLOX_MAX_PARTS=10000
ROBLOX_MAX_SCRIPTS=100

# ============================================
# MONITORING & ANALYTICS
# ============================================
# Sentry Error Tracking
SENTRY_DSN=your_sentry_dsn_here
SENTRY_ENVIRONMENT=development

# Google Analytics
VITE_GOOGLE_ANALYTICS_ID=your_ga_id_here

# Rate Limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_PER_MINUTE=60

# ============================================
# LMS INTEGRATIONS (OPTIONAL)
# ============================================
# Canvas LMS
VITE_CANVAS_API_TOKEN=your_canvas_token_here

# ============================================
# COMPLIANCE & SECURITY
# ============================================
# Educational Compliance
VITE_COPPA_COMPLIANCE=true
VITE_FERPA_COMPLIANCE=true
VITE_GDPR_COMPLIANCE=true

# Authentication Tokens (Frontend)
VITE_AUTH_TOKEN_KEY=toolboxai_auth_token
VITE_AUTH_REFRESH_TOKEN_KEY=toolboxai_refresh_token

# ============================================
# DEVELOPMENT & TESTING
# ============================================
# Development Flags
VITE_DEBUG_MODE=true
VITE_MOCK_API=false

# RBAC Configuration (JSON format)
SIO_RBAC_REQUIRED_ROLES={"content_request":"teacher","subscribe":"student","unsubscribe":"student","quiz_response":"student","progress_update":"student","collaboration_message":"student","ping":"student"}
WS_RBAC_REQUIRED_ROLES={"broadcast":"teacher","content_request":"teacher","roblox_event":"teacher"}
WS_CHANNEL_ROLE_PREFIXES={"admin_":"admin","teacher_":"teacher"}

# ============================================
# SECURITY NOTES & BEST PRACTICES
# ============================================
# 1. NEVER commit this file with real credentials to version control
# 2. Use different credentials for each environment (dev/staging/prod)
# 3. Generate secure keys using:
#    - JWT Secret: openssl rand -hex 32
#    - Database Password: openssl rand -base64 32
#    - Redis Password: openssl rand -base64 24
# 4. Store production secrets in a secure vault:
#    - AWS Secrets Manager
#    - HashiCorp Vault
#    - Docker Secrets
#    - GitHub Secrets (for CI/CD)
# 5. Rotate credentials regularly
# 6. Monitor for exposed credentials using:
#    - GitHub Secret Scanning
#    - GitGuardian
#    - TruffleHog
# 7. Use HTTPS in production (set SSL flags to true)
# 8. Set DEBUG=false and LOG_LEVEL=WARNING in production
# ============================================
# ============================================
# CELERY BACKGROUND JOBS
# ============================================
# Broker Configuration
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/0
CELERY_BROKER_CONNECTION_RETRY=true
CELERY_BROKER_CONNECTION_MAX_RETRIES=100

# Worker Configuration
CELERY_WORKER_CONCURRENCY=4
CELERY_WORKER_MAX_TASKS_PER_CHILD=1000
CELERY_TASK_TIME_LIMIT=300
CELERY_TASK_SOFT_TIME_LIMIT=270
CELERY_TASK_ACKS_LATE=true
CELERY_TASK_REJECT_ON_WORKER_LOST=true
CELERY_LOG_LEVEL=INFO

# Beat Scheduler Configuration
CELERY_BEAT_LOG_LEVEL=INFO
CELERY_BEAT_MAX_LOOP_INTERVAL=60
CELERY_BEAT_SCHEDULE_FILENAME=/app/celerybeat-schedule/celerybeat-schedule.db

# Flower Monitoring (Development only)
FLOWER_USER=admin
FLOWER_PASSWORD=your_secure_flower_password_here
FLOWER_PORT=5555
FLOWER_BASIC_AUTH=admin:your_secure_flower_password_here

# ============================================
# ROJO SERVER (Roblox Sync)
# ============================================
ROJO_SERVER_HOST=0.0.0.0
ROJO_SERVER_PORT=34872
ROJO_PROJECT_PATH=/app/default.project.json
ROJO_LIVE_RELOAD=true
ROJO_DEV_MODE=false
ROJO_LOG_LEVEL=info

# Roblox Deployment
ROBLOX_DEPLOYMENT_ENABLED=false
ROBLOX_AUTO_DEPLOY=false
ROBLOX_DEPLOY_BRANCH=main
ROBLOX_DEPLOY_KEY=your_deployment_key_here

# ============================================
# MONITORING & OBSERVABILITY STACK
# ============================================
# Grafana Dashboard
GRAFANA_USER=admin
GRAFANA_PASSWORD=your_secure_grafana_password_here
GRAFANA_ROOT_URL=http://localhost:3000
GRAFANA_SMTP_ENABLED=false
GRAFANA_SMTP_HOST=smtp.example.com:587
GRAFANA_SMTP_USER=notifications@toolboxai.com
GRAFANA_SMTP_PASSWORD=your_smtp_password_here

# Prometheus Metrics
PROMETHEUS_RETENTION_TIME=30d
PROMETHEUS_RETENTION_SIZE=10GB
PROMETHEUS_SCRAPE_INTERVAL=30s
PROMETHEUS_EVALUATION_INTERVAL=30s

# Loki Log Aggregation
LOKI_RETENTION_PERIOD=720h
LOKI_CHUNK_TARGET_SIZE=1572864
LOKI_MAX_CHUNK_AGE=1h
LOKI_CHUNK_IDLE_PERIOD=30m

# Jaeger Distributed Tracing
JAEGER_AGENT_HOST=localhost
JAEGER_AGENT_PORT=6831
JAEGER_SAMPLING_TYPE=probabilistic
JAEGER_SAMPLING_RATE=0.01
JAEGER_COLLECTOR_ENDPOINT=http://localhost:14268/api/traces

# Alertmanager
ALERTMANAGER_EXTERNAL_URL=http://localhost:9093
ALERTMANAGER_SMTP_FROM=alerts@toolboxai.com
ALERTMANAGER_SMTP_SMARTHOST=smtp.example.com:587
ALERTMANAGER_SMTP_AUTH_USERNAME=smtp_username
ALERTMANAGER_SMTP_AUTH_PASSWORD=smtp_password
ALERTMANAGER_SLACK_WEBHOOK=https://hooks.slack.com/services/YOUR/WEBHOOK/URL

# ============================================
# DOCKER CONFIGURATION
# ============================================
# Docker Registry (for BuildKit cache)
DOCKER_REGISTRY=docker.io
DOCKER_TAG=latest
DATA_DIR=./data

# Resource Limits
MAX_CONCURRENT_AGENTS=10
TASK_TIMEOUT=300
WORKERS=4
# Add your new GitHub token to .env file
GITHUB_TOKEN=your_new_token_here
GITHUB_WEBHOOK_SECRET=your_webhook_secret_here
