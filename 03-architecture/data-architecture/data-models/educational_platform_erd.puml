@startuml
!define ENTITY entity
!define TABLE(x) class x << (T,#FFAAAA) >>
!define PRIMARY_KEY(x) <u>x</u>
!define FOREIGN_KEY(x) <i>x</i>

title Educational Platform Database ERD

TABLE(users) {
  password_hash: VARCHAR(255)
  first_name: VARCHAR(100)
  last_name: VARCHAR(100)
  display_name: VARCHAR(200)
  avatar_url: VARCHAR(500)
  bio: TEXT
  role: VARCHAR(20)
  grade_level: INTEGER
  school_name: VARCHAR(200)
  district_name: VARCHAR(200)
  subjects_taught: JSONB
  subjects_interested: JSONB
  is_active: BOOLEAN
  is_verified: BOOLEAN
  is_superuser: BOOLEAN
  email_verified_at: TIMESTAMPTZ
  last_login: TIMESTAMPTZ
  login_count: INTEGER
  failed_login_count: INTEGER
  locked_until: TIMESTAMPTZ
  two_factor_enabled: BOOLEAN
  two_factor_secret: VARCHAR(255)
  settings: JSONB
  preferences: JSONB
  notification_settings: JSONB
  created_at: TIMESTAMPTZ
  updated_at: TIMESTAMPTZ
  FOREIGN_KEY(created_by): UUID
  FOREIGN_KEY(updated_by): UUID
  version: INTEGER
  audit_log: JSONB
}

TABLE(roles) {
  description: TEXT
  is_system: BOOLEAN
  priority: INTEGER
  permissions: JSONB
  created_at: TIMESTAMPTZ
  updated_at: TIMESTAMPTZ
}

TABLE(user_roles) {
  FOREIGN_KEY(user_id): UUID
  FOREIGN_KEY(role_id): UUID
  assigned_at: TIMESTAMPTZ
  FOREIGN_KEY(assigned_by): UUID
}

TABLE(user_sessions) {
  FOREIGN_KEY(user_id): UUID
  session_type: VARCHAR(20)
  ip_address: INET
  user_agent: TEXT
  device_id: VARCHAR(255)
  browser_fingerprint: VARCHAR(500)
  country: VARCHAR(2)
  timezone: VARCHAR(50)
  locale: VARCHAR(10)
  created_at: TIMESTAMPTZ
  expires_at: TIMESTAMPTZ
  refresh_expires_at: TIMESTAMPTZ
  last_activity: TIMESTAMPTZ
  is_active: BOOLEAN
  revoked_at: TIMESTAMPTZ
  revoked_reason: VARCHAR(255)
  security_events: JSONB
}

TABLE(learning_objectives) {
  title: VARCHAR(200)
  description: TEXT
  subject: VARCHAR(50)
  bloom_level: VARCHAR(20)
  curriculum_standard: VARCHAR(100)
  measurable: BOOLEAN
  created_at: TIMESTAMPTZ
  updated_at: TIMESTAMPTZ
}

TABLE(educational_content) {
  title: VARCHAR(200)
  description: TEXT
  subject: VARCHAR(50)
  grade_level: INTEGER
  environment_type: VARCHAR(50)
  terrain_size: VARCHAR(20)
  difficulty_level: VARCHAR(20)
  duration_minutes: INTEGER
  max_students: INTEGER
  content_data: JSONB
  generated_scripts: JSONB
  terrain_config: JSONB
  game_mechanics: JSONB
  accessibility_features: BOOLEAN
  multilingual: BOOLEAN
  version: INTEGER
  is_template: BOOLEAN
  is_published: BOOLEAN
  FOREIGN_KEY(created_by): UUID
  created_at: TIMESTAMPTZ
  updated_at: TIMESTAMPTZ
}

TABLE(content_objectives) {
  FOREIGN_KEY(content_id): UUID
  FOREIGN_KEY(objective_id): UUID
}

TABLE(quizzes) {
  title: VARCHAR(200)
  description: TEXT
  subject: VARCHAR(50)
  grade_level: INTEGER
  FOREIGN_KEY(content_id): UUID
  time_limit: INTEGER
  passing_score: INTEGER
  max_attempts: INTEGER
  shuffle_questions: BOOLEAN
  shuffle_options: BOOLEAN
  show_results: BOOLEAN
  is_adaptive: BOOLEAN
  difficulty_progression: JSONB
  FOREIGN_KEY(created_by): UUID
  created_at: TIMESTAMPTZ
  updated_at: TIMESTAMPTZ
}

TABLE(quiz_questions) {
  FOREIGN_KEY(quiz_id): UUID
  question_type: VARCHAR(20)
  question_text: TEXT
  correct_answer: TEXT
  difficulty: VARCHAR(20)
  points: INTEGER
  time_limit: INTEGER
  hint: TEXT
  explanation: TEXT
  order_index: INTEGER
  question_data: JSONB
  created_at: TIMESTAMPTZ
}

TABLE(quiz_options) {
  FOREIGN_KEY(question_id): UUID
  option_text: TEXT
  is_correct: BOOLEAN
  explanation: TEXT
  order_index: INTEGER
  created_at: TIMESTAMPTZ
}

TABLE(quiz_attempts) {
  FOREIGN_KEY(quiz_id): UUID
  FOREIGN_KEY(user_id): UUID
  FOREIGN_KEY(session_id): UUID
  attempt_number: INTEGER
  started_at: TIMESTAMPTZ
  completed_at: TIMESTAMPTZ
  score: DECIMAL
  passed: BOOLEAN
  time_taken: INTEGER
  answers: JSONB
  feedback: JSONB
  adaptive_adjustments: JSONB
}

TABLE(user_progress) {
  FOREIGN_KEY(user_id): UUID
  FOREIGN_KEY(content_id): UUID
  progress_type: VARCHAR(20)
  completion_percentage: DECIMAL
  time_spent_seconds: INTEGER
  attempts_count: INTEGER
  best_score: DECIMAL
  current_streak: INTEGER
  max_streak: INTEGER
  difficulty_level: VARCHAR(20)
  mastery_level: VARCHAR(20)
  last_interaction: TIMESTAMPTZ
  FOREIGN_KEY(next_recommended_content): UUID
  learning_style: JSONB
  performance_trends: JSONB
  recommendations: JSONB
  created_at: TIMESTAMPTZ
  updated_at: TIMESTAMPTZ
}


@enduml